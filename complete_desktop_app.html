<!DOCTYPE html>
<html>
<head>
    <title>AiBeatzbyJyntzu - Enhanced Desktop Edition</title>
    <meta charset="UTF-8">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0f0f0f; color: #fff; font-family: Arial; overflow: hidden; margin: 0; }
        
        /* Custom Title Bar */
        .title-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 10001;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(10px);
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            border-bottom: 1px solid #333;
            -webkit-app-region: drag;
            cursor: move;
        }
        
        .title-bar * {
            -webkit-app-region: no-drag;
        }
        
        .window-controls {
            display: flex;
            gap: 2px;
        }
        
        .window-btn {
            width: 25px;
            height: 25px;
            border: none;
            background: rgba(255,255,255,0.1);
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            border-radius: 3px;
            transition: all 0.2s;
        }
        
        .window-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }
        
        .close-btn:hover {
            background: #ff4444;
        }
        
        /* Progress Bar */
        .progress-overlay {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: auto;
            height: auto;
            background: none;
            display: none;
            z-index: 10000;
        }
        
        .progress-container {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(10px);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 15px 25px;
            text-align: center;
            min-width: 300px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        
        .progress-title {
            color: #ffd700;
            font-size: 14px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 15px;
            background: #333;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 8px;
        }
        
        .progress-text {
            color: #ccc;
            font-size: 12px;
        }
        
        .minimize-btn:hover {
            background: #ffd700;
            color: #000;
        }
        
        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .login-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            min-width: 400px;
        }
        
        .login-title {
            font-size: 2.5em;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .login-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 16px;
        }
        
        .login-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            margin: 20px 0;
            border: none;
            border-radius: 10px;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 9999;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            cursor: pointer;
            user-select: none;
        }
        
        .notification:hover {
            transform: translateX(0) scale(1.02);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: linear-gradient(45deg, #f44336, #d32f2f);
        }
        
        .notification.warning {
            background: linear-gradient(45deg, #ff9800, #f57c00);
        }
        
        .app-container { height: 100vh; display: flex; flex-direction: column; }
        
        /* Catalog Management */
        .catalog-section {
            background: rgba(255,215,0,0.1);
            border: 1px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .catalog-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
            margin: 5px 0;
        }
        
        .add-catalog-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .account-filter-btn {
            background: #2d2d2d;
            color: #ffd700;
            border: 1px solid #ffd700;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .account-filter-btn.active {
            background: #ffd700;
            color: #000;
        }
        
        .account-filter-btn:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        
        .user-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        
        .action-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
        }
        
        .ban-btn {
            background: #f44336;
            color: white;
        }
        
        .restore-btn {
            background: #4CAF50;
            color: white;
        }
        
        .remove-btn {
            background: #ff9800;
            color: white;
        }
        .header { background: #1f1f1f; padding: 10px 20px 10px 20px; margin-top: 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #ffd700; }
        .header h1 { color: #ffd700; font-size: 20px; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .logout-btn { padding: 5px 10px; background: #ff4444; border: none; border-radius: 5px; color: white; cursor: pointer; }
        .theme-selector { padding: 4px 8px; background: #2d2d2d; color: #fff; border: 1px solid #555; border-radius: 4px; }
        .tabs { background: #1a1a1a; display: flex; border-bottom: 1px solid #333; }
        .tab { padding: 12px 20px; background: #2d2d2d; color: #ffd700; border: none; cursor: pointer; border-right: 1px solid #333; font-weight: bold; }
        .tab.active { background: #ffd700; color: #000; }
        .tab:hover { background: #ffed4e; color: #000; }
        .content { flex: 1; overflow-y: auto; padding: 20px; max-height: calc(100vh - 140px); }
        .section { background: #1a1a1a; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .control { display: flex; flex-direction: column; }
        label { color: #ffd700; margin-bottom: 5px; font-weight: bold; font-size: 12px; }
        input, select, textarea, button { padding: 8px; background: #2d2d2d; color: #fff; border: 1px solid #555; border-radius: 4px; }
        button { background: #ffd700; color: #000; cursor: pointer; font-weight: bold; }
        button:hover { background: #ffed4e; }
        .generate-btn { padding: 15px 30px; font-size: 16px; margin: 20px 0; }
        .beat-item { background: #2d2d2d; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #ffd700; }
        
        .beat-metadata {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            display: none;
        }
        
        .metadata-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .metadata-section {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 5px;
        }
        
        .metadata-title {
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .metadata-item {
            font-size: 12px;
            color: #ccc;
            margin: 3px 0;
        }
        
        .expand-btn {
            background: transparent;
            border: 1px solid #ffd700;
            color: #ffd700;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 11px;
            margin-left: 10px;
        }
        
        .expand-btn:hover {
            background: rgba(255,215,0,0.1);
        }
        .beat-controls { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .status { padding: 10px; background: #333; border-radius: 4px; margin: 10px 0; }
        .error { background: #d32f2f; }
        .success { background: #4caf50; }
        .chat-container { height: 300px; background: #2d2d2d; border: 2px solid #ffd700; border-radius: 8px; padding: 15px; overflow-y: auto; margin-bottom: 15px; }
        .chat-input { display: flex; gap: 10px; }
        .chat-input input { flex: 1; }
        .analytics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .analytics-card { background: #2d2d2d; padding: 20px; border-radius: 8px; border-left: 4px solid #ffd700; }
        .sampling-controls { background: #2d2d2d; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .hidden { display: none; }
        
        /* Compact Audio Player */
        .compact-player {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid #ffd700;
            border-radius: 25px;
            padding: 8px 15px;
            margin: 0 20px;
        }
        
        .compact-play-btn, .compact-loop-btn {
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .compact-play-btn:hover, .compact-loop-btn:hover {
            transform: scale(1.1);
        }
        
        .compact-loop-btn.active {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }
        
        .compact-info {
            flex: 1;
            min-width: 200px;
        }
        
        .now-playing {
            font-size: 12px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .compact-progress {
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }
        
        .compact-progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            border-radius: 2px;
            width: 0%;
            transition: width 0.1s;
        }
        
        .compact-time {
            font-size: 11px;
            color: rgba(255,255,255,0.8);
            min-width: 40px;
            text-align: center;
        }
        
        /* File List */
        .file-list {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .file-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .file-name {
            font-weight: bold;
        }
        
        .file-date {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
        }
        
        /* Enhanced Space Theme */
        .space-theme {
            background: radial-gradient(ellipse at center, #0c1445 0%, #000000 100%);
            position: relative;
            overflow: hidden;
        }
        
        .space-theme::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, #eee, transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(2px 2px at 160px 30px, #fff, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: starfield 20s linear infinite;
            z-index: -1;
            pointer-events: none;
        }
        
        .floating-orb {
            position: fixed;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(138, 43, 226, 0.8) 0%, rgba(138, 43, 226, 0.2) 70%);
            animation: floatPath 25s linear infinite, colorShift 8s ease-in-out infinite;
            z-index: -1;
            pointer-events: none;
        }
        
        @keyframes starfield {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100px); }
        }
        
        @keyframes floatPath {
            0% { transform: translate(100px, 100px); }
            25% { transform: translate(calc(100vw - 180px), 200px); }
            50% { transform: translate(calc(100vw - 200px), calc(100vh - 200px)); }
            75% { transform: translate(150px, calc(100vh - 150px)); }
            100% { transform: translate(100px, 100px); }
        }
        
        @keyframes colorShift {
            0% { background: radial-gradient(circle, rgba(138, 43, 226, 0.8) 0%, rgba(138, 43, 226, 0.2) 70%); }
            25% { background: radial-gradient(circle, rgba(0, 255, 255, 0.8) 0%, rgba(0, 255, 255, 0.2) 70%); }
            50% { background: radial-gradient(circle, rgba(255, 20, 147, 0.8) 0%, rgba(255, 20, 147, 0.2) 70%); }
            75% { background: radial-gradient(circle, rgba(50, 205, 50, 0.8) 0%, rgba(50, 205, 50, 0.2) 70%); }
            100% { background: radial-gradient(circle, rgba(138, 43, 226, 0.8) 0%, rgba(138, 43, 226, 0.2) 70%); }
        }
        
        /* Enhanced animations */
        @keyframes slideIn {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
        @keyframes shimmer {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(100%); }
        }
        @keyframes twinkle {
          0% { opacity: 0.3; }
          50% { opacity: 1; }
          100% { opacity: 0.6; }
        }
        @keyframes timeWarp {
          0% { 
            opacity: 0.8;
            filter: blur(0px) hue-rotate(0deg);
          }
          50% { 
            opacity: 1;
            filter: blur(1px) hue-rotate(180deg);
          }
          100% { 
            opacity: 0.9;
            filter: blur(0px) hue-rotate(360deg);
          }
        }
        @keyframes starMove {
          0% { background-position: 0% 0%; }
          100% { background-position: 100% 100%; }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <h1 class="login-title">ğŸµ AiBeatzbyJyntzu</h1>
            <input type="text" id="username" class="login-input" placeholder="Username" />
            <input type="password" id="password" class="login-input" placeholder="Password" />
            <button onclick="handleLogin()" class="login-btn">Login</button>
            <div style="margin-top: 20px; font-size: 14px; color: rgba(255,255,255,0.7);">
                Demo: user/demo
            </div>
        </div>
    </div>

    <!-- Progress Bar Overlay -->
    <div id="progressOverlay" class="progress-overlay">
        <div class="progress-container">
            <div class="progress-title">ğŸµ Generating Beat</div>
            <div class="progress-bar-container">
                <div id="progressBar" class="progress-bar"></div>
            </div>
            <div id="progressText" class="progress-text">Initializing...</div>
        </div>
    </div>

    <div class="app-container" id="mainApp" style="display: none;">
        <!-- Custom Title Bar -->
        <div class="title-bar">
            <div style="color: #ffd700; font-weight: bold; font-size: 14px;">ğŸµ AiBeatzbyJyntzu</div>
            <div class="window-controls">
                <button class="window-btn minimize-btn" onclick="minimizeWindow()" title="Minimize">âˆ’</button>
                <button class="window-btn close-btn" onclick="closeWindow()" title="Close">Ã—</button>
            </div>
        </div>
        
        <!-- Header -->
        <div class="header">
            <h1>ğŸµ AiBeatzbyJyntzu - Enhanced Desktop Edition</h1>
            
            <!-- Compact Audio Player -->
            <div id="compactPlayer" class="compact-player" style="display: none;">
                <button id="playBtn" class="compact-play-btn" onclick="togglePlay()">â–¶ï¸</button>
                <div class="compact-info">
                    <div id="nowPlaying" class="now-playing">No beat selected</div>
                    <div class="compact-progress" onclick="seekAudio(event)">
                        <div id="compactProgressBar" class="compact-progress-bar"></div>
                    </div>
                </div>
                <div id="timeDisplay" class="compact-time">0:00</div>
                <button id="loopBtn" class="compact-loop-btn" onclick="toggleLoop()">ğŸ”</button>
                <audio id="beatAudio" preload="auto"></audio>
            </div>
            
            <div class="user-info">
                <span id="userWelcome">Welcome, Producer!</span>
                <select class="theme-selector" onchange="changeTheme(this.value)">
                    <option value="dark-gold">ğŸŒ™ Dark Gold</option>
                    <option value="cyber-blue">ğŸ’™ Cyber Blue</option>
                    <option value="neon-purple">ğŸ’œ Neon Purple</option>
                    <option value="forest-green">ğŸ’š Forest Green</option>
                    <option value="sunset-orange">ğŸ§¡ Sunset Orange</option>
                    <option value="royal-red">â¤ï¸ Royal Red</option>
                    <option value="arctic-white">ğŸ¤ Arctic White</option>
                    <option value="midnight-black">ğŸ–¤ Midnight Black</option>
                    <option value="space">ğŸš€ Space</option>
                    <option value="undaworld">ğŸ”¥ UndaWorld</option>
                    <option value="psychedelic">ğŸŒˆ Psychedelic</option>
                    <option value="mary-jane">ğŸŒ¿ Mary Jane</option>
                </select>
                <button onclick="logout()" class="logout-btn">Logout</button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('studio')">ğŸµ Studio</button>
            <button class="tab" onclick="showTab('sampling')">ğŸ›ï¸ Sampling</button>
            <button class="tab" onclick="showTab('ailearning')">ğŸ§  AI Learning</button>
            <button class="tab" onclick="showTab('puter')">ğŸ¤– Puter AI</button>
            <button class="tab" onclick="showTab('proposals')">ğŸ’¡ Proposals</button>
            <button class="tab" onclick="showTab('accounts')">ğŸ‘¥ Accounts</button>
            <button class="tab" onclick="showTab('notifications')" id="notificationsTab" style="display: none;">ğŸ“¢ Notifications</button>
            <button class="tab" onclick="showTab('analytics')" id="analyticsTab">ğŸ“Š Analytics</button>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Studio Tab -->
            <div id="studio-tab" class="tab-content">
                <div class="section">
                    <h2 style="color: #ffd700; margin-bottom: 20px;">ğŸµ Beat Studio</h2>
                    
                    <!-- AI Learning Status -->
                    <div id="aiStatus" style="background: rgba(255,215,0,0.1); border: 1px solid #ffd700; border-radius: 8px; padding: 10px; margin-bottom: 15px; font-size: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <span style="color: #ffd700; font-weight: bold;">ğŸ¤– AI Status:</span> 
                                <span id="aiStatusText" style="color: #4CAF50;">AI Enhanced - Scanner teaching beat generation</span>
                            </div>
                            <div style="display: flex; gap: 5px;">
                                <button onclick="showTab('ailearning')" style="background: #2196F3; color: white; border: none; padding: 5px 10px; border-radius: 15px; font-size: 11px; cursor: pointer;">ğŸ§  AI Learning</button>
                                <button id="aiToggle" onclick="toggleAILearning()" style="background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 15px; font-size: 11px; cursor: pointer;">AI ON</button>
                            </div>
                        </div>
                        
                        <!-- Mini Analytics Display -->
                        <div id="miniAnalytics" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,215,0,0.3); display: flex; gap: 15px; font-size: 11px;">
                            <div>Tracks: <span id="miniTotalTracks" style="color: #4CAF50; font-weight: bold;">0</span></div>
                            <div>Accuracy: <span id="miniAccuracy" style="color: #FF9800; font-weight: bold;">0%</span></div>
                            <div>Speed: <span id="miniSpeed" style="color: #9C27B0; font-weight: bold;">0</span>/min</div>
                            <div id="miniLearningFeed" style="color: #888; font-style: italic; flex: 1; text-align: right;">Ready for AI training</div>
                        </div>
                    </div>
                    
                    <!-- Beat Mode Selection -->
                    <div style="margin-bottom: 20px;">
                        <label>Beat Generation Mode:</label>
                        <select id="beatMode" onchange="toggleAdvancedOptions()">
                            <option value="inputs">ğŸ›ï¸ Use Inputs (Smart Sampling + AI analysis)</option>
                            <option value="creative">ğŸ¨ Creative Direction (concept-based)</option>
                            <option value="description">ğŸ“ Description Only</option>
                        </select>
                    </div>

                    <!-- Advanced Sampling Controls -->
                    <div id="advancedSampling" class="sampling-controls">
                        <h3 style="color: #ffd700; margin-bottom: 10px;">ğŸ¯ Intelligent Sampling Controls</h3>
                        <div class="controls">
                            <div class="control">
                                <label>Style Era</label>
                                <select id="styleEra">
                                    <option value="modern">ğŸ”¥ Modern</option>
                                    <option value="old_school">ğŸ“» Old School</option>
                                </select>
                            </div>
                            <div class="control">
                                <label>Sample Keyword</label>
                                <input type="text" id="samplingKeyword" placeholder="e.g., dark, piano, vocal, 808">
                            </div>
                            <div class="control">
                                <label>Analysis Mode</label>
                                <select id="audioAnalysis">
                                    <option value="content">ğŸ§  Audio Content Analysis</option>
                                    <option value="filename">ğŸ“ Filename Matching</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Creative Direction Controls -->
                    <div id="creativeControls" class="sampling-controls hidden">
                        <h3 style="color: #ffd700; margin-bottom: 10px;">ğŸ¨ Creative Direction</h3>
                        <div class="controls">
                            <div class="control">
                                <label>Beat Concept</label>
                                <select id="beatConcept">
                                    <option value="street_life">ğŸ™ï¸ Street Life</option>
                                    <option value="love_story">ğŸ’• Love Story</option>
                                    <option value="struggle">ğŸ’ª Struggle</option>
                                    <option value="success">ğŸ† Success</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Main Controls -->
                    <div class="controls">
                        <div class="control">
                            <label>Genre</label>
                            <select id="genre">
                                <option>Rap</option><option>Hip-Hop</option><option>Trap</option><option>Drill</option><option>UK Drill</option>
                                <option>Boom Bap</option><option>Lo-Fi</option><option>Gangsta</option><option>East Coast</option>
                                <option>West Coast</option><option>Dirty South</option><option>Cloud Rap</option><option>Afrobeats</option>
                                <option>Jersey Club</option><option>Phonk</option><option>Rage</option><option>Experimental</option>
                                <option>Memphis</option><option>Crunk</option><option>Hyphy</option><option>Chopped & Screwed</option>
                                <option>G-Funk</option><option>Horrorcore</option><option>Industrial Hip-Hop</option><option>Jazz Rap</option>
                                <option>Alternative Hip-Hop</option><option>Conscious Rap</option><option>Hardcore Hip-Hop</option>
                                <option>EDM</option><option>Pop</option><option>Hyperpop</option><option>Emo</option>
                                <option>Heavy Metal</option><option>Metalcore</option>
                            </select>
                        </div>
                        <div class="control">
                            <label>Mood</label>
                            <select id="mood">
                                <option>Chill</option><option>Aggressive</option><option>Dark</option><option>Energetic</option>
                                <option>Melancholic</option><option>Uplifting</option><option>Sad</option><option>Happy</option>
                                <option>Epic</option><option>Laid Back</option><option>Intense</option><option>Dreamy</option>
                                <option>Mysterious</option><option>Romantic</option><option>Angry</option><option>Peaceful</option>
                                <option>Nostalgic</option><option>Euphoric</option><option>Anxious</option><option>Confident</option>
                                <option>Rebellious</option><option>Spiritual</option><option>Playful</option><option>Serious</option>
                                <option>Haunting</option><option>Triumphant</option><option>Lonely</option><option>Hopeful</option>
                                <option>Sinister</option><option>Majestic</option><option>Chaotic</option><option>Serene</option>
                                <option>Eerie</option><option>Void</option><option>Experimental</option><option>Holy</option><option>Evil</option>
                            </select>
                        </div>
                        <div class="control">
                            <label>Tempo: <span id="tempoValue">120</span> BPM <span id="tempoTime" style="color: #888;"></span></label>
                            <input type="range" id="tempo" min="60" max="180" value="120" oninput="updateTempo()">
                        </div>
                        <div class="control">
                            <label>Length: <span id="lengthValue">32</span> bars <span id="lengthTime" style="color: #888;"></span></label>
                            <input type="range" id="length" min="4" max="120" value="32" oninput="updateLength()">
                        </div>
                        <div class="control">
                            <label>EQ Low: <span id="eqLowValue">0</span> dB</label>
                            <input type="range" id="eqLow" min="-12" max="12" value="0" oninput="document.getElementById('eqLowValue').textContent = this.value">
                        </div>
                        <div class="control">
                            <label>EQ Mid: <span id="eqMidValue">0</span> dB</label>
                            <input type="range" id="eqMid" min="-12" max="12" value="0" oninput="document.getElementById('eqMidValue').textContent = this.value">
                        </div>
                        <div class="control">
                            <label>EQ High: <span id="eqHighValue">0</span> dB</label>
                            <input type="range" id="eqHigh" min="-12" max="12" value="0" oninput="document.getElementById('eqHighValue').textContent = this.value">
                        </div>
                        <div class="control">
                            <label>Complexity</label>
                            <select id="complexity">
                                <option value="simple">ğŸ”´ Simple</option>
                                <option value="intermediate" selected>ğŸŸ¡ Intermediate</option>
                                <option value="advanced">ğŸŸ  Advanced</option>
                                <option value="expert">ğŸ”´ Expert</option>
                            </select>
                        </div>
                        <div class="control">
                            <label>Vocal Content (All Catalogs)</label>
                            <select id="vocalContent">
                                <option value="any">ğŸµ Any (All Files)</option>
                                <option value="with_vocals">ğŸ¤ Use Vocal Tracks (Extract Beat)</option>
                                <option value="instrumental">ğŸ¹ Instrumental Files Only</option>
                                <option value="vocal_samples">ğŸ—£ï¸ Extract Vocal Samples</option>
                            </select>
                        </div>
                        <div class="control">
                            <label>Drum Kit</label>
                            <select id="drumKit">
                                <option value="default" selected>ğŸ¥ Default (Any Drum Sounds)</option>
                                <option value="random">ğŸ² Random Kit</option>
                                <option value="$uicideboy$">ğŸ”¥ $uicideboy$ Kit</option>
                                <option value="1017 BRICKSQUAD">ğŸ’ 1017 BRICKSQUAD Kit</option>
                                <option value="21 Savage - Savage Mode">ğŸ”ª 21 Savage Kit</option>
                                <option value="9th Wonder">ğŸ¹ 9th Wonder Kit</option>
                                <option value="Alchemist">âš—ï¸ Alchemist Kit</option>
                                <option value="AraabMuzik">ğŸ›ï¸ AraabMuzik Kit</option>
                                <option value="Big Money Talk">ğŸ’° Big Money Talk Kit</option>
                                <option value="BigheadOnTheBeat">ğŸ§ BigheadOnTheBeat Kit</option>
                                <option value="Blvnt$">ğŸ’¨ Blvnt$ Kit</option>
                                <option value="Boi-1da">ğŸµ Boi-1da Kit</option>
                                <option value="BoomBap">ğŸ“» BoomBap Kit</option>
                                <option value="Cash Money">ğŸ’¸ Cash Money Kit</option>
                                <option value="Caveman">ğŸ¦´ Caveman Kit</option>
                                <option value="Certified Trap Star">â­ Trap Star Kit</option>
                                <option value="CHANTS VOCALS PHILLY 215">ğŸ—£ï¸ Philly Chants Kit</option>
                                <option value="Chillstep">â„ï¸ Chillstep Kit</option>
                                <option value="Chris Brown">ğŸ¤ Chris Brown Kit</option>
                                <option value="D Block">ğŸ¢ D Block Kit</option>
                                <option value="Deep House">ğŸ  Deep House Kit</option>
                                <option value="Diddy">ğŸ‘‘ Diddy Kit</option>
                                <option value="Diplo">ğŸ§ Diplo Kit</option>
                                <option value="DJ Mustard">ğŸŒ­ DJ Mustard Kit</option>
                                <option value="Dr. Dre">ğŸ©º Dr. Dre Kit</option>
                                <option value="Drake">ğŸ¦† Drake Kit</option>
                                <option value="Drill">âš”ï¸ Drill Kit</option>
                                <option value="Dubstep">ğŸ”Š Dubstep Kit</option>
                                <option value="East Coast">ğŸ™ï¸ East Coast Kit</option>
                                <option value="Eminem">ğŸ¤ Eminem Kit</option>
                                <option value="GloomSounds">ğŸŒ«ï¸ GloomSounds Kit</option>
                                <option value="Goon Related">ğŸ‘¥ Goon Related Kit</option>
                                <option value="Gucci Mane">ğŸ’ Gucci Mane Kit</option>
                                <option value="Hardstyle">âš¡ Hardstyle Kit</option>
                                <option value="Jahlil Beats">ğŸ¥ Jahlil Beats Kit</option>
                                <option value="Jay-Z">ğŸ‘‘ Jay-Z Kit</option>
                                <option value="JetsonMade">ğŸš€ JetsonMade Kit</option>
                                <option value="Johnny Juliano Goonie">ğŸ¯ Johnny Juliano Goonie Kit</option>
                                <option value="Johnny Juliano Trap Ghosts">ğŸ‘» Johnny Juliano Trap Ghosts Kit</option>
                                <option value="Kanye West">ğŸ» Kanye West Kit</option>
                                <option value="Lex Luger">ğŸ”¥ Lex Luger Kit</option>
                                <option value="Lil Pump">ğŸ’Š Lil Pump Kit</option>
                                <option value="Lil Uzi Vert">ğŸ›¸ Lil Uzi Vert Kit</option>
                                <option value="Lil Wayne">ğŸ¤ Lil Wayne Kit</option>
                                <option value="LONDON ON THA TRACK">ğŸ‡¬ğŸ‡§ London On Tha Track Kit</option>
                                <option value="Meek Mill">ğŸƒ Meek Mill Kit</option>
                                <option value="Metro Boomin">ğŸ¹ Metro Boomin Kit</option>
                                <option value="Mike Will Made It">ğŸ›ï¸ Mike Will Made It Kit</option>
                                <option value="Mobb Deep">ğŸŒŠ Mobb Deep Kit</option>
                                <option value="Murda Beatz">ğŸ”ª Murda Beatz Kit</option>
                                <option value="Nav XO">âœ–ï¸ Nav XO Kit</option>
                                <option value="Pierre Bourne">ğŸŒŒ Pierre Bourne Kit</option>
                                <option value="Playboi Carti">ğŸ§› Playboi Carti Kit</option>
                                <option value="Reggaeton">ğŸï¸ Reggaeton Kit</option>
                                <option value="Rick Ross">ğŸ‘‘ Rick Ross Kit</option>
                                <option value="Scarlxrd">ğŸ˜ˆ Scarlxrd Kit</option>
                                <option value="Scott Storch">ğŸ¹ Scott Storch Kit</option>
                                <option value="Sonny Digital Going Digital">ğŸ’» Sonny Digital Kit</option>
                                <option value="Swiss Beatz">ğŸ‡¨ğŸ‡­ Swiss Beatz Kit</option>
                                <option value="TM88 Nightmare">ğŸ˜± TM88 Kit</option>
                                <option value="TNT Trap Metal">ğŸ’¥ TNT Trap Metal Kit</option>
                                <option value="Vintage Hip Hop">ğŸ“» Vintage Hip Hop Kit</option>
                                <option value="Vybe Beatz Appreciation">ğŸ™ Vybe Beatz Kit</option>
                                <option value="West Coast">ğŸŒ´ West Coast Kit</option>
                                <option value="Wheezy Outta Here">ğŸ’¨ Wheezy Kit</option>
                                <option value="WIZ KHALIFA">ğŸŒ¿ Wiz Khalifa Kit</option>
                                <option value="Wu-Tang Clan">âš”ï¸ Wu-Tang Kit</option>
                                <option value="XXXTENTACION">âŒ XXXTENTACION Kit</option>
                                <option value="Young Chop">ğŸ”¥ Young Chop Kit</option>
                                <option value="Zaytoven">ğŸ¹ Zaytoven Kit</option>
                            </select>
                        </div>
                        <div class="control">
                            <label>AI Learning Mode</label>
                            <select id="aiLearningMode" onchange="updateAIToggleColor()">
                                <option value="off">ğŸ”´ Off - Standard Generation</option>
                                <option value="passive" selected>ğŸŸ¡ Passive - Learn from Generation</option>
                                <option value="active">ğŸŸ¢ Active - AI Enhanced Generation</option>
                            </select>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label>Description & Keywords</label>
                        <textarea id="description" placeholder="Keywords: dark piano, heavy 808, vocal chops..." rows="3" style="width: 100%; margin-top: 5px;"></textarea>
                    </div>

                    <button class="generate-btn" onclick="generateBeat()">ğŸµ Generate Beat</button>
                    <div id="status"></div>
                </div>

                <!-- Generated Beats -->
                <div class="section">
                    <h2 style="color: #ffd700; margin-bottom: 20px;">Generated Beats</h2>
                    <div id="beats"></div>
                </div>
                
                <!-- File Library -->
                <div class="section">
                    <h2 style="color: #ffd700; margin-bottom: 20px;">ğŸ“ File Library</h2>
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <h3 style="color: #ffd700;">ğŸ“Š Total Files</h3>
                            <p>Generated Beats: <span id="totalBeatsCount">0</span></p>
                            <p>Audio Files: <span id="totalAudioCount">0</span></p>
                            <p>Storage Used: <span id="storageUsed">0 MB</span></p>
                        </div>
                        <div class="analytics-card">
                            <h3 style="color: #ffd700;">ğŸµ Recent Activity</h3>
                            <p>Last Generated: <span id="lastGenerated">None</span></p>
                            <p>Session Beats: <span id="sessionBeats">0</span></p>
                            <p>Success Rate: <span id="successRate">100%</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sampling Tab -->
            <div id="sampling-tab" class="tab-content hidden">
                <div class="section">
                    <h2 style="color: #ffd700; margin-bottom: 20px;">ğŸ›ï¸ Advanced Sampling System</h2>
                    <div class="sampling-controls">
                        <h3 style="color: #ffd700; margin-bottom: 10px;">Sampling Settings</h3>
                        <div class="controls">
                            <div class="control">
                                <label>Chopping Method</label>
                                <select id="choppingMethod">
                                    <option value="auto">ğŸ¤– Auto Detect</option>
                                    <option value="beats">ğŸ¥ Beat-Based</option>
                                    <option value="transients">âš¡ Transient-Based</option>
                                    <option value="equal">ğŸ“ Equal Segments</option>
                                    <option value="spectral">ğŸŒŠ Spectral Analysis</option>
                                    <option value="onset">ğŸ¯ Onset Detection</option>
                                    <option value="pitch">ğŸµ Pitch-Based</option>
                                    <option value="manual">âœ‚ï¸ Manual Markers</option>
                                </select>
                            </div>
                            <div class="control">
                                <label>Style</label>
                                <select id="samplingStyle">
                                    <option value="modern_trap">ğŸ”¥ Modern Trap</option>
                                    <option value="old_school_boom_bap">ğŸ“» Old School Boom Bap</option>
                                    <option value="modern_drill">âš”ï¸ Modern Drill</option>
                                    <option value="old_school_jazz">ğŸ· Old School Jazz</option>
                                    <option value="uk_garage">ğŸ‡¬ğŸ‡§ UK Garage</option>
                                    <option value="phonk_memphis">ğŸ‘» Phonk Memphis</option>
                                    <option value="lofi_chillhop">ğŸŒ™ Lo-Fi Chillhop</option>
                                    <option value="afrobeats_amapiano">ğŸŒ Afrobeats Amapiano</option>
                                    <option value="experimental_glitch">ğŸ”¬ Experimental Glitch</option>
                                </select>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button onclick="applySamplingToStudio()" style="flex: 1;">ğŸµ Apply to Beat Studio</button>
                            <button onclick="unapplySamplingFromStudio()" style="flex: 1; background: #f44336;">âŒ Un-apply from Studio</button>
                        </div>
                    </div>
                    
                    <!-- Sample Library Management -->
                    <div class="catalog-section">
                        <h3 style="color: #ffd700; margin-bottom: 15px;">ğŸ“ Sample Library</h3>
                        <div id="libraryCatalogList">
                            <div class="catalog-item">
                                <div>
                                    <strong>Chosen-1</strong><br>
                                    <small style="color: #888;">C:\Users\Jintsu\Desktop\Chosen-1</small>
                                </div>
                                <span style="color: #4CAF50;">Active</span>
                            </div>
                            <div class="catalog-item">
                                <div>
                                    <strong>JINTSU CATALOG</strong><br>
                                    <small style="color: #888;">C:\Users\Jintsu\Desktop\JINTSU_CATALOG</small>
                                </div>
                                <span style="color: #4CAF50;">Active</span>
                            </div>
                            <div class="catalog-item">
                                <div>
                                    <strong>Drumkits</strong><br>
                                    <small style="color: #888;">C:\Users\Jintsu\Desktop\AiBeatzbyJyntzu\drumkits\unpacked</small>
                                </div>
                                <span style="color: #4CAF50;">Active</span>
                            </div>
                        </div>
                        <button class="add-catalog-btn" onclick="addLibraryCatalog()">â• Add Sample Catalog</button>
                    </div>
                </div>
            </div>

            <!-- Puter AI Tab -->
            <div id="puter-tab" class="tab-content hidden">
                <div class="section">
                    <h2 style="color: #ffd700; margin-bottom: 20px;">ğŸ¤– Puter AI Chat</h2>
                    

                    <div style="margin-bottom: 15px;">
                        <label>Chat Mode:</label>
                        <select id="chatContext">
                            <option value="beat">ğŸµ Beat Generation</option>
                            <option value="lyrics">ğŸ“ Lyrics Writing</option>
                            <option value="keywords">ğŸ·ï¸ Keywords & Tags</option>
                            <option value="music">ğŸ¶ Music Production</option>
                            <option value="features">ğŸ’¡ App Ideas & Features</option>
                            <option value="general">ğŸ’¬ General Chat</option>
                        </select>
                    </div>
                    <div class="chat-container" id="chatContainer">
                        <div style="color: #888; font-style: italic; text-align: center; padding-top: 100px;">
                            ğŸ’¬ Start a conversation with Puter AI<br>
                            <span style="font-size: 14px;">Ask about beats, production tips, or music theory!</span>
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="Type your message to Puter AI..." onkeypress="if(event.key==='Enter') sendChat()">
                        <button onclick="sendChat()">Send ğŸ“¤</button>
                    </div>
                </div>
            </div>

            <!-- Proposals Tab -->
            <div id="proposals-tab" class="tab-content hidden">
                <div class="section">
                    <h2 style="color: #ffd700; margin-bottom: 20px;">ğŸ’¡ Feature Proposals</h2>
                    <p style="color: #ccc; margin-bottom: 20px;">Go to Puter AI chat, select "App Ideas & Features" mode, and describe your idea!</p>
                    <div id="proposalsList"></div>
                </div>
            </div>

            <!-- Accounts Tab -->
            <div id="accounts-tab" class="tab-content hidden">
                <div class="section">
                    <h2 style="color: #ffd700; margin-bottom: 20px;">ğŸ‘¥ Account Management</h2>
                    <div id="adminSection" style="display: none;">
                        <div style="margin-bottom: 20px; display: flex; gap: 10px;">
                            <button id="createAccountBtn" onclick="createNewAccount()" style="background: #4CAF50;">â• Create New Account</button>
                            <button onclick="showActiveUsers()" class="account-filter-btn active" data-filter="active">ğŸ‘¥ Active Users</button>
                            <button onclick="showInactiveUsers()" class="account-filter-btn" data-filter="inactive">ğŸš« Inactive Users</button>
                        </div>
                    </div>
                    <div id="userSection">
                        <p style="text-align: center; margin-top: 50px; color: #888;">Account management restricted to administrators only.</p>
                    </div>
                    <div id="accountsList"></div>
                </div>
            </div>

            <!-- AI Learning Tab -->
            <div id="ailearning-tab" class="tab-content hidden">
                <div class="section">
                    <h2 style="color: #ffd700; margin-bottom: 20px;">ğŸ§  AI Learning System</h2>
                    
                    <!-- AI Learning Progress -->
                    <div class="section" style="background: rgba(255,215,0,0.1); border: 2px solid #ffd700;">
                        <h3 style="color: #ffd700; margin-bottom: 15px;">ğŸµ Train AI on Music Patterns</h3>
                        
                        <!-- Music Scanner Controls -->
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="color: #ffd700; margin-bottom: 10px;">ğŸµ YouTube & SoundCloud Training</h4>
                            <div class="controls">
                                <div class="control">
                                    <label>Training Mode</label>
                                    <select id="trainingMode">
                                        <option value="single_genre">ğŸ¯ Single Genre Deep Scan</option>
                                        <option value="multi_genre">ğŸŒ Multi-Genre Analysis</option>
                                        <option value="artist_style">ğŸ‘¤ Artist Style Learning</option>
                                        <option value="mood_analysis">ğŸ˜Š Mood Pattern Analysis</option>
                                    </select>
                                </div>
                                <div class="control">
                                    <label>Target Genre</label>
                                    <select id="trainingGenre">
                                        <option>Rap</option><option>Hip-Hop</option><option>Trap</option><option>Drill</option><option>UK Drill</option>
                                        <option>Boom Bap</option><option>Lo-Fi</option><option>Gangsta</option><option>East Coast</option>
                                        <option>West Coast</option><option>Dirty South</option><option>Cloud Rap</option><option>Afrobeats</option>
                                        <option>Jersey Club</option><option>Phonk</option><option>Rage</option><option>Experimental</option>
                                        <option>Memphis</option><option>Crunk</option><option>Hyphy</option><option>Chopped & Screwed</option>
                                        <option>G-Funk</option><option>Horrorcore</option><option>Industrial Hip-Hop</option><option>Jazz Rap</option>
                                        <option>Alternative Hip-Hop</option><option>Conscious Rap</option><option>Hardcore Hip-Hop</option>
                                        <option>EDM</option><option>Pop</option><option>Hyperpop</option><option>Emo</option>
                                        <option>Heavy Metal</option><option>Metalcore</option>
                                    </select>
                                </div>
                                <div class="control">
                                    <label>Target Mood</label>
                                    <select id="trainingMood">
                                        <option>Chill</option><option>Aggressive</option><option>Dark</option><option>Energetic</option>
                                        <option>Melancholic</option><option>Uplifting</option><option>Sad</option><option>Happy</option>
                                        <option>Epic</option><option>Laid Back</option><option>Intense</option><option>Dreamy</option>
                                        <option>Mysterious</option><option>Romantic</option><option>Angry</option><option>Peaceful</option>
                                        <option>Nostalgic</option><option>Euphoric</option><option>Anxious</option><option>Confident</option>
                                        <option>Rebellious</option><option>Spiritual</option><option>Playful</option><option>Serious</option>
                                        <option>Haunting</option><option>Triumphant</option><option>Lonely</option><option>Hopeful</option>
                                        <option>Sinister</option><option>Majestic</option><option>Chaotic</option><option>Serene</option>
                                        <option>Eerie</option><option>Void</option><option>Experimental</option><option>Holy</option><option>Evil</option>
                                    </select>
                                </div>
                                <div class="control">
                                    <label>Analysis Depth</label>
                                    <select id="analysisDepth">
                                        <option value="10">ğŸ” Quick (10 tracks)</option>
                                        <option value="25" selected>ğŸ“Š Standard (25 tracks)</option>
                                        <option value="50">ğŸ¯ Deep (50 tracks)</option>
                                        <option value="100">ğŸ§  Expert (100 tracks)</option>
                                    </select>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button onclick="startAITraining()" style="background: #4CAF50; flex: 1;">ğŸš€ Start AI Training</button>
                                <button onclick="viewTrainingData()" style="background: #2196F3; flex: 1;">ğŸ“Š View Training Data</button>
                                <button onclick="exportLearningModel()" style="background: #FF9800; flex: 1;">ğŸ’¾ Export Model</button>
                            </div>
                            <div id="trainingStatus" style="margin-top: 10px; color: #888; font-size: 12px;">Ready to train AI on music patterns</div>
                        </div>
                        
                        <!-- Learning Statistics -->
                        <div class="analytics-grid">
                            <div class="analytics-card">
                                <h4 style="color: #ffd700;">ğŸ“ˆ YouTube & SoundCloud Tracks</h4>
                                <div style="font-size: 24px; font-weight: bold; color: #4CAF50; margin: 10px 0;" id="totalTracksAnalyzed">0</div>
                                <div class="progress-bar-container" style="margin: 10px 0;">
                                    <div id="tracksProgress" class="progress-bar" style="width: 0%;"></div>
                                </div>
                                <div style="font-size: 12px; color: #888;">Goal: 1000 tracks from both platforms</div>
                            </div>
                            <div class="analytics-card">
                                <h4 style="color: #ffd700;">ğŸµ Music Patterns Learned</h4>
                                <div style="font-size: 24px; font-weight: bold; color: #2196F3; margin: 10px 0;" id="patternsLearned">0</div>
                                <div class="progress-bar-container" style="margin: 10px 0;">
                                    <div id="patternsProgress" class="progress-bar" style="width: 0%; background: linear-gradient(45deg, #2196F3, #64B5F6);"></div>
                                </div>
                                <div style="font-size: 12px; color: #888;">Rhythm, melody, harmony patterns</div>
                            </div>
                            <div class="analytics-card">
                                <h4 style="color: #ffd700;">ğŸ¯ Beat Generation Accuracy</h4>
                                <div style="font-size: 24px; font-weight: bold; color: #FF9800; margin: 10px 0;" id="beatAccuracy">0%</div>
                                <div class="progress-bar-container" style="margin: 10px 0;">
                                    <div id="accuracyProgress" class="progress-bar" style="width: 0%; background: linear-gradient(45deg, #FF9800, #FFB74D);"></div>
                                </div>
                                <div style="font-size: 12px; color: #888;">Based on user ratings</div>
                            </div>
                            <div class="analytics-card">
                                <h4 style="color: #ffd700;">âš¡ AI Learning Speed</h4>
                                <div style="font-size: 24px; font-weight: bold; color: #9C27B0; margin: 10px 0;" id="learningSpeed">0</div>
                                <div class="progress-bar-container" style="margin: 10px 0;">
                                    <div id="speedProgress" class="progress-bar" style="width: 0%; background: linear-gradient(45deg, #9C27B0, #BA68C8);"></div>
                                </div>
                                <div style="font-size: 12px; color: #888;">tracks/minute analyzed</div>
                            </div>
                        </div>
                        
                        <!-- Genre Analysis Breakdown -->
                        <div style="margin-top: 20px;">
                            <h4 style="color: #ffd700; margin-bottom: 10px;">ğŸ¼ Genre Analysis Breakdown</h4>
                            <div id="genreBreakdown" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;"></div>
                        </div>
                        
                        <!-- Learning Milestones -->
                        <div style="margin-top: 20px;">
                            <h4 style="color: #ffd700; margin-bottom: 10px;">ğŸ† AI Learning Milestones</h4>
                            <div id="milestones" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
                        </div>
                        
                        <!-- Real-time Learning Feed -->
                        <div style="margin-top: 20px;">
                            <h4 style="color: #ffd700; margin-bottom: 10px;">ğŸ“¡ Real-time Learning Feed</h4>
                            <div id="learningFeed" style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 15px; max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 11px;"></div>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <!-- Notifications Tab -->
            <div id="notifications-tab" class="tab-content hidden">
                <div class="section">
                    <h2 style="color: #ffd700; margin-bottom: 20px;">ğŸ“¢ Live Notifications System</h2>
                    
                    <!-- Send Notification -->
                    <div class="section" style="background: rgba(255,215,0,0.1); border: 2px solid #ffd700;">
                        <h3 style="color: #ffd700; margin-bottom: 15px;">ğŸ“± Send Live Notification</h3>
                        <div class="controls">
                            <div class="control">
                                <label>Notification Type</label>
                                <select id="notificationType">
                                    <option value="info">ğŸ“ Info</option>
                                    <option value="update">ğŸ†• Update</option>
                                    <option value="promo">ğŸ‰ Promotion</option>
                                    <option value="warning">âš ï¸ Warning</option>
                                    <option value="maintenance">ğŸ”§ Maintenance</option>
                                </select>
                            </div>
                            <div class="control">
                                <label>Target Users</label>
                                <select id="notificationTarget">
                                    <option value="all">ğŸŒ All Users</option>
                                    <option value="admins">ğŸ‘‘ Admins Only</option>
                                    <option value="users">ğŸ‘¤ Regular Users</option>
                                    <option value="online">ğŸŸ¢ Online Users</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin: 15px 0;">
                            <label>Notification Title</label>
                            <input type="text" id="notificationTitle" placeholder="e.g., New Update Available" style="width: 100%; margin-top: 5px;">
                        </div>
                        <div style="margin: 15px 0;">
                            <label>Message</label>
                            <textarea id="notificationMessage" placeholder="Enter your notification message..." rows="4" style="width: 100%; margin-top: 5px;"></textarea>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button onclick="sendLiveNotification()" style="background: #4CAF50; flex: 1;">ğŸš€ Send Notification</button>
                            <button onclick="previewNotification()" style="background: #2196F3; flex: 1;">ğŸ‘ï¸ Preview</button>
                        </div>
                    </div>
                    
                    <!-- Notification History -->
                    <div class="section">
                        <h3 style="color: #ffd700; margin-bottom: 15px;">ğŸ“… Notification History</h3>
                        <div id="notificationHistory" style="max-height: 300px; overflow-y: auto;"></div>
                    </div>
                    
                    <!-- Live Stats -->
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <h4 style="color: #ffd700;">ğŸ“Š Delivery Stats</h4>
                            <div style="font-size: 24px; font-weight: bold; color: #4CAF50; margin: 10px 0;" id="totalNotifications">0</div>
                            <div style="font-size: 12px; color: #888;">Total sent today</div>
                        </div>
                        <div class="analytics-card">
                            <h4 style="color: #ffd700;">ğŸ‘¥ Active Users</h4>
                            <div style="font-size: 24px; font-weight: bold; color: #2196F3; margin: 10px 0;" id="activeUsersCount">0</div>
                            <div style="font-size: 12px; color: #888;">Currently online</div>
                        </div>
                        <div class="analytics-card">
                            <h4 style="color: #ffd700;">ğŸŒ Website Status</h4>
                            <div style="font-size: 16px; font-weight: bold; color: #4CAF50; margin: 10px 0;">chosen1.cloud</div>
                            <div style="font-size: 12px; color: #888;">Ready for launch</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Analytics Tab -->
            <div id="analytics-tab" class="tab-content hidden">
                <div class="section">
                    <h2 style="color: #ffd700; margin-bottom: 20px;">ğŸ“Š Analytics Dashboard</h2>
                    
                    <div id="adminAnalytics" style="display: none;">
                        <div class="analytics-grid" id="analyticsGrid"></div>
                    </div>
                    <div id="userAnalytics">
                        <p style="text-align: center; margin-top: 50px; color: #888;">Analytics access restricted to administrators only.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="close_fix.js"></script>
    <script>
        let beatCount = 0;
        let generatedBeatNames = new Set();
        let chatMessages = [];
        let currentTheme = 'dark-gold';
        let sessionStart = Date.now();
        let currentUser = null;
        let userLevel = 3; // 1=Owner Admin, 2=Employee Admin, 3=User
        let generatedBeats = [];
        let isLooping = false;
        let currentAccountFilter = 'active';
        let userAccounts = [];
        let onlineUsers = [];
        let heartbeatInterval = null;
        let onlineUsersInterval = null;
        let aiLearningStats = {
            totalTracks: 0,
            genresLearned: new Set(),
            accuracy: 0,
            learningSpeed: 0,
            milestones: []
        };
        
        // Persistent analytics storage
        function saveUserAnalytics() {
            const analytics = {
                user: currentUser,
                aiLearningStats: {
                    totalTracks: aiLearningStats.totalTracks,
                    genresLearned: Array.from(aiLearningStats.genresLearned),
                    accuracy: aiLearningStats.accuracy,
                    learningSpeed: aiLearningStats.learningSpeed,
                    milestones: aiLearningStats.milestones
                },
                generatedBeats: generatedBeats.length,
                sessionStart: sessionStart,
                lastSaved: Date.now()
            };
            localStorage.setItem(`aibeatz_analytics_${currentUser}`, JSON.stringify(analytics));
        }
        
        function loadUserAnalytics() {
            const saved = localStorage.getItem(`aibeatz_analytics_${currentUser}`);
            if (saved) {
                const analytics = JSON.parse(saved);
                aiLearningStats.totalTracks = analytics.aiLearningStats.totalTracks || 0;
                aiLearningStats.genresLearned = new Set(analytics.aiLearningStats.genresLearned || []);
                aiLearningStats.accuracy = analytics.aiLearningStats.accuracy || 0;
                aiLearningStats.learningSpeed = analytics.aiLearningStats.learningSpeed || 0;
                aiLearningStats.milestones = analytics.aiLearningStats.milestones || [];
                
                // Update displays
                updateAILearningDisplay();
                updateAIStatus(aiLearningStats.totalTracks);
                updateMiniAnalytics('Analytics loaded from previous session');
            }
        }
        
        function initializeUserAnalytics(username) {
            const defaultAnalytics = {
                user: username,
                aiLearningStats: {
                    totalTracks: 0,
                    genresLearned: [],
                    accuracy: 0,
                    learningSpeed: 0,
                    milestones: []
                },
                generatedBeats: 0,
                sessionStart: Date.now(),
                lastSaved: Date.now()
            };
            localStorage.setItem(`aibeatz_analytics_${username}`, JSON.stringify(defaultAnalytics));
        }
        let aiLearningEnabled = true;
        let aiLearningMode = 'passive';
        let notificationHistory = [];
        let generatedBeatSignatures = new Set();
        
        function ensureBeatUniqueness(beatSignature) {
            // Always generate new signature with additional entropy
            const entropySignature = `${beatSignature}_${Date.now()}_${Math.random()}_${performance.now()}`;
            
            generatedBeatSignatures.add(entropySignature);
            
            if (generatedBeatSignatures.size > 1000) {
                const signatures = Array.from(generatedBeatSignatures);
                generatedBeatSignatures = new Set(signatures.slice(-1000));
            }
            
            return entropySignature;
        }
        
        // Generation history tracking
        function getUserGenerationHistory() {
            const history = localStorage.getItem(`aibeatz_generation_history_${currentUser}`);
            return history ? JSON.parse(history) : {
                genrePreferences: {},
                moodPreferences: {},
                complexityUsage: {},
                tempoRanges: [],
                totalBeats: 0
            };
        }
        
        function updateGenerationHistory(genre, mood, complexity, tempo) {
            const history = getUserGenerationHistory();
            
            history.genrePreferences[genre] = (history.genrePreferences[genre] || 0) + 1;
            history.moodPreferences[mood] = (history.moodPreferences[mood] || 0) + 1;
            history.complexityUsage[complexity] = (history.complexityUsage[complexity] || 0) + 1;
            history.tempoRanges.push(tempo);
            history.totalBeats++;
            
            // Keep only last 50 tempo entries
            if (history.tempoRanges.length > 50) {
                history.tempoRanges = history.tempoRanges.slice(-50);
            }
            
            localStorage.setItem(`aibeatz_generation_history_${currentUser}`, JSON.stringify(history));
        }
        
        function calculateHistoryInfluence(history, genre, mood) {
            const genreCount = history.genrePreferences[genre] || 0;
            const moodCount = history.moodPreferences[mood] || 0;
            const totalBeats = history.totalBeats || 1;
            
            return {
                volume: Math.min(0.05, genreCount / totalBeats * 0.2),
                decay: Math.min(0.3, moodCount / totalBeats * 0.5),
                attack: Math.min(2, genreCount / 10),
                melody: Math.min(0.04, (genreCount + moodCount) / totalBeats * 0.15),
                harmony: 1.25992 + (moodCount / totalBeats * 0.1),
                extended: 1.49831 + (genreCount / totalBeats * 0.15)
            };
        }
        
        function adaptChordsToSettings(baseChords, complexity, historyInfluence, tempo) {
            const adapted = [...baseChords];
            
            // Modify based on complexity
            if (complexity === 'expert') {
                adapted.forEach((chord, i) => {
                    adapted[i] = chord * (1 + historyInfluence.extended * 0.1);
                });
            } else if (complexity === 'simple') {
                adapted.forEach((chord, i) => {
                    adapted[i] = chord * 0.95; // Slightly lower for simplicity
                });
            }
            
            // Tempo-based adjustments
            const tempoFactor = tempo > 140 ? 1.05 : tempo < 100 ? 0.95 : 1.0;
            adapted.forEach((chord, i) => {
                adapted[i] = chord * tempoFactor;
            });
            
            return adapted;
        }
        
        function calculateNoteVariations(step, historyInfluence, complexity, mood, tempo) {
            const baseVariation = step % 8 === 6 ? 1.25 : 1.0;
            const historyFactor = 1 + (historyInfluence.melody || 0);
            
            // Complexity-based variations
            const complexityMultiplier = {
                'simple': 0.9,
                'intermediate': 1.0,
                'advanced': 1.1,
                'expert': 1.2
            }[complexity] || 1.0;
            
            // Mood-based pitch shifts
            const moodShifts = {
                'Dark': [1.189, 1.414], // Minor intervals
                'Aggressive': [1.414, 1.682], // Tritone, minor seventh
                'Chill': [1.25992, 1.49831], // Major third, perfect fifth
                'Melancholic': [1.189, 1.33484], // Minor second, minor sixth
                'Energetic': [1.33484, 1.587] // Major sixth, minor seventh
            };
            
            const shifts = moodShifts[mood] || moodShifts['Chill'];
            const melodicShift = step % 16 === 12 ? shifts[1] : shifts[0];
            
            return {
                pitch: baseVariation * historyFactor * complexityMultiplier,
                melodic: melodicShift * complexityMultiplier * (1 + historyInfluence.attack * 0.1)
            };
        }
        
        // Real-time user tracking functions
        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch {
                return 'Unknown';
            }
        }
        
        async function getUserLocation() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                return `${data.city}, ${data.country_name}`;
            } catch {
                return 'Unknown';
            }
        }
        
        function startHeartbeat() {
            heartbeatInterval = setInterval(async () => {
                // Heartbeat disabled for offline mode
                console.log('Offline mode - heartbeat disabled');
            }, 30000); // Every 30 seconds
        }
        
        function startOnlineUsersPolling() {
            if (userLevel > 2) return;
            
            // Online users polling disabled for offline mode
            console.log('Offline mode - online users polling disabled');
        }
        
        function updateOnlineUsersDisplay() {
            if (userLevel > 2) return;
            
            const list = document.getElementById('accountsList');
            if (currentAccountFilter === 'active') {
                // Update the active users list with online status
                showActiveUsers();
            }
        }

        // All 12 themes with drastically different styles
        const themes = {
            'dark-gold': { primary: '#FFD700', bg: '#0f0f0f', secondary: '#1f1f1f', text: '#ffffff', accent: '#FFA500' },
            'cyber-blue': { primary: '#00FFFF', bg: '#001122', secondary: '#003366', text: '#00FFFF', accent: '#0099FF' },
            'neon-purple': { primary: '#FF00FF', bg: '#2D0A4E', secondary: '#4A1B7A', text: '#E6E6FA', accent: '#9932CC' },
            'forest-green': { primary: '#00FF00', bg: '#0D2818', secondary: '#1A4A2E', text: '#F0FFF0', accent: '#32CD32' },
            'sunset-orange': { primary: '#FF4500', bg: '#2F1B14', secondary: '#5D2F1E', text: '#FFF8DC', accent: '#FF6347' },
            'royal-red': { primary: '#8B0000', bg: '#330000', secondary: '#660000', text: '#FFE4E1', accent: '#DC143C' },
            'arctic-white': { primary: '#4169E1', bg: '#F8F8FF', secondary: '#E6E6FA', text: '#191970', accent: '#87CEEB' },
            'midnight-black': { primary: '#C0C0C0', bg: '#000000', secondary: '#0A0A0A', text: '#DCDCDC', accent: '#696969' },
            'space': { primary: '#9370DB', bg: '#000000', secondary: '#0A0A0A', text: '#E6E6FA', accent: '#6A5ACD' },
            'undaworld': { primary: '#B22222', bg: '#1A0000', secondary: '#330000', text: '#FFB6C1', accent: '#CD5C5C' },
            'psychedelic': { primary: '#FF1493', bg: '#4B0082', secondary: '#8A2BE2', text: '#FFFFE0', accent: '#FF69B4' },
            'mary-jane': { primary: '#228B22', bg: '#013220', secondary: '#2E8B57', text: '#F5FFFA', accent: '#90EE90' }
        };

        // Login system with real-time tracking
        async function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showNotification('Please enter username and password', 'error');
                return;
            }
            
            // Check credentials locally first
            if (username === 'admin' && password === 'blWymQ3w%sOAmamwi&jkVeUh') {
                currentUser = username;
                userLevel = 1; // Owner Admin
            } else if (username === 'user' && password === 'demo') {
                currentUser = username;
                userLevel = 3; // Regular User
            } else {
                showNotification('Invalid credentials', 'error');
                return;
            }
            
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            const userTitle = userLevel === 1 ? 'Owner Admin' : userLevel === 2 ? 'Employee Admin' : 'Producer';
            document.getElementById('userWelcome').textContent = `Welcome, ${userTitle}!`;
            
            // Show/hide sections based on user level
            if (userLevel === 1) { // Owner Admin only
                document.getElementById('adminSection').style.display = 'block';
                document.getElementById('userSection').style.display = 'none';
                document.getElementById('adminAnalytics').style.display = 'block';
                document.getElementById('userAnalytics').style.display = 'none';
                document.getElementById('createAccountBtn').style.display = 'inline-block';
                document.getElementById('analyticsTab').style.display = 'block';
                document.getElementById('notificationsTab').style.display = 'block';
            } else if (userLevel === 2) { // Employee Admin
                document.getElementById('adminSection').style.display = 'block';
                document.getElementById('userSection').style.display = 'none';
                document.getElementById('adminAnalytics').style.display = 'block';
                document.getElementById('userAnalytics').style.display = 'none';
                document.getElementById('createAccountBtn').style.display = 'inline-block';
                document.getElementById('analyticsTab').style.display = 'block';
                document.getElementById('notificationsTab').style.display = 'none';
            } else { // Regular users
                document.getElementById('adminSection').style.display = 'none';
                document.getElementById('userSection').style.display = 'block';
                document.getElementById('adminAnalytics').style.display = 'none';
                document.getElementById('userAnalytics').style.display = 'block';
                document.getElementById('analyticsTab').style.display = 'none';
                document.getElementById('notificationsTab').style.display = 'none';
            }
            
            showNotification(`Welcome ${userTitle}!`, 'success');
            
            // Load user analytics
            loadUserAnalytics();
            
            initializeApp();
        }
        
        async function logout() {
            // Offline mode - no server logout needed
            console.log('Offline logout');
            
            // Stop heartbeat
            if (heartbeatInterval) {
                clearInterval(heartbeatInterval);
                heartbeatInterval = null;
            }
            
            // Stop online users polling
            if (onlineUsersInterval) {
                clearInterval(onlineUsersInterval);
                onlineUsersInterval = null;
            }
            
            currentUser = null;
            userLevel = 3;
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            showNotification('Logged out successfully', 'success');
        }
        
        // Notification system
        function showNotification(message, type = 'success') {
            // Prevent duplicate notifications
            const existing = document.querySelector('.notification');
            if (existing && existing.textContent === message) return;
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cursor = 'pointer';
            notification.textContent = message;
            
            // Add click to dismiss
            notification.onclick = function() {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            };
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        function showAccountCreatedNotification(username, password, role) {
            const notification = document.createElement('div');
            notification.className = 'notification success';
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px;
                background: linear-gradient(45deg, #4CAF50, #45a049);
                color: white; padding: 15px 25px; border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 9999;
                transform: translateX(400px); transition: transform 0.3s ease;
                cursor: pointer; user-select: none; min-width: 300px;
            `;
            
            const passwordHidden = 'â€¢'.repeat(password.length);
            let isPasswordVisible = false;
            
            function updateContent() {
                notification.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px;">âœ… Account Created</div>
                    <div style="font-size: 13px; line-height: 1.4;">
                        <div><strong>Username:</strong> ${username}</div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span><strong>Password:</strong> ${isPasswordVisible ? password : passwordHidden}</span>
                            <button onclick="togglePassword(event)" style="
                                background: rgba(255,255,255,0.2); border: none; color: white;
                                padding: 2px 6px; border-radius: 3px; cursor: pointer; font-size: 11px;
                            ">${isPasswordVisible ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸'}</button>
                        </div>
                        <div><strong>Role:</strong> ${role}</div>
                    </div>
                    <div style="font-size: 11px; margin-top: 8px; opacity: 0.8;">Click anywhere to dismiss</div>
                `;
            }
            
            window.togglePassword = function(event) {
                event.stopPropagation();
                isPasswordVisible = !isPasswordVisible;
                updateContent();
            };
            
            updateContent();
            
            // Add click to dismiss
            notification.onclick = function(event) {
                if (event.target.tagName !== 'BUTTON') {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            document.body.removeChild(notification);
                        }
                        delete window.togglePassword;
                    }, 300);
                }
            };
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                    delete window.togglePassword;
                }, 300);
            }, 8000); // Longer timeout for account notifications
        }
        
        // Audio player functions
        function togglePlay() {
            const audio = document.getElementById('beatAudio');
            const playBtn = document.getElementById('playBtn');
            
            if (isPlaying) {
                // Currently playing - pause it
                if (currentAudioSource) {
                    currentAudioSource.stop();
                    currentAudioSource = null;
                } else if (!audio.paused) {
                    audio.pause();
                }
                playBtn.textContent = 'â–¶ï¸';
                isPlaying = false;
            } else {
                // Currently paused - play it
                if (generatedBeats.length > 0) {
                    playBeat(generatedBeats[0].id);
                } else {
                    showNotification('No beats available to play', 'warning');
                }
            }
        }
        
        function toggleLoop() {
            const audio = document.getElementById('beatAudio');
            const loopBtn = document.getElementById('loopBtn');
            
            isLooping = !isLooping;
            audio.loop = isLooping;
            loopBtn.classList.toggle('active', isLooping);
        }
        
        function seekAudio(event) {
            const audio = document.getElementById('beatAudio');
            const progressContainer = event.currentTarget;
            const clickX = event.offsetX;
            const width = progressContainer.offsetWidth;
            const duration = audio.duration;
            
            if (duration) {
                audio.currentTime = (clickX / width) * duration;
            }
        }
        
        function generateBeatAudio(beat) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const tempo = beat.tempo || 120;
            const length = beat.length || 32;
            const genre = beat.metadata?.settings?.genre || 'Hip-Hop';
            const mood = beat.metadata?.settings?.mood || 'Chill';
            const drumKit = beat.metadata?.settings?.drumKit || 'random';
            
            const beatDuration = (length * 4 * 60) / tempo;
            const sampleRate = audioContext.sampleRate;
            const buffer = audioContext.createBuffer(2, sampleRate * beatDuration, sampleRate);
            
            // Determine drum kit selection logic
            let actualDrumKit = drumKit;
            
            if (drumKit === 'default') {
                // Default: pull from any drum sound files
                actualDrumKit = 'any_drums';
            } else if (drumKit === 'random') {
                // Random Kit: randomly select from available kits
                const availableKits = [
                    '$uicideboy$', '1017 BRICKSQUAD', '21 Savage - Savage Mode', '9th Wonder', 'Alchemist',
                    'AraabMuzik', 'Big Money Talk', 'BigheadOnTheBeat', 'Blvnt$', 'Boi-1da', 'BoomBap',
                    'Cash Money', 'Caveman', 'Certified Trap Star', 'CHANTS VOCALS PHILLY 215', 'Chillstep',
                    'Chris Brown', 'D Block', 'Deep House', 'Diddy', 'Diplo', 'DJ Mustard', 'Dr. Dre',
                    'Drake', 'Drill', 'Dubstep', 'East Coast', 'Eminem', 'GloomSounds', 'Goon Related',
                    'Gucci Mane', 'Hardstyle', 'Jahlil Beats', 'Jay-Z', 'JetsonMade', 'Johnny Juliano Goonie',
                    'Johnny Juliano Trap Ghosts', 'Kanye West', 'Lex Luger', 'Lil Pump', 'Lil Uzi Vert',
                    'Lil Wayne', 'LONDON ON THA TRACK', 'Meek Mill', 'Metro Boomin', 'Mike Will Made It',
                    'Mobb Deep', 'Murda Beatz', 'Nav XO', 'Pierre Bourne', 'Playboi Carti', 'Reggaeton',
                    'Rick Ross', 'Scarlxrd', 'Scott Storch', 'Sonny Digital Going Digital', 'Swiss Beatz',
                    'TM88 Nightmare', 'TNT Trap Metal', 'Vintage Hip Hop', 'Vybe Beatz Appreciation',
                    'West Coast', 'Wheezy Outta Here', 'WIZ KHALIFA', 'Wu-Tang Clan', 'XXXTENTACION',
                    'Young Chop', 'Zaytoven'
                ];
                actualDrumKit = availableKits[Math.floor(Math.random() * availableKits.length)];
            }
            
            // Kit-specific patterns and sounds (expanded with more kits)
            const kitPatterns = {
                'any_drums': {
                    kick: [1,0,0,1, 0,0,1,0, 1,0,0,1, 0,0,1,0], 
                    hihat: [1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1], 
                    snare: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                    kickFreq: 55, snareFreq: 220
                },
                'Metro Boomin': { 
                    kick: [1,0,0,1, 0,0,1,0, 1,0,0,1, 0,0,1,0], 
                    hihat: [1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1], 
                    snare: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                    kickFreq: 55, snareFreq: 250
                },
                'Drill': { 
                    kick: [1,0,1,0, 1,1,0,0, 1,0,1,0, 1,1,0,0], 
                    hihat: [1,1,0,1, 1,0,1,1, 1,1,0,1, 1,0,1,1], 
                    snare: [0,0,0,0, 1,0,0,1, 0,0,0,0, 1,0,0,1],
                    kickFreq: 60, snareFreq: 280
                },
                'BoomBap': { 
                    kick: [1,0,0,0, 1,0,0,0, 1,0,0,0, 1,0,0,0], 
                    hihat: [0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1], 
                    snare: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                    kickFreq: 50, snareFreq: 200
                },
                'Lex Luger': { 
                    kick: [1,0,0,1, 0,1,0,0, 1,0,0,1, 0,1,0,0], 
                    hihat: [1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1], 
                    snare: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                    kickFreq: 58, snareFreq: 260
                },
                '$uicideboy$': {
                    kick: [1,0,1,0, 0,1,0,1, 1,0,1,0, 0,1,0,1], 
                    hihat: [1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1], 
                    snare: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                    kickFreq: 45, snareFreq: 300
                },
                'Pierre Bourne': {
                    kick: [1,0,0,0, 1,0,1,0, 1,0,0,0, 1,0,1,0], 
                    hihat: [1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1], 
                    snare: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                    kickFreq: 52, snareFreq: 240
                },
                'TM88 Nightmare': {
                    kick: [1,0,0,1, 0,0,1,0, 1,0,0,1, 0,0,1,0], 
                    hihat: [1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1], 
                    snare: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                    kickFreq: 48, snareFreq: 270
                },
                'Zaytoven': {
                    kick: [1,0,0,0, 1,0,0,0, 1,0,0,0, 1,0,0,0], 
                    hihat: [1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1], 
                    snare: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                    kickFreq: 53, snareFreq: 230
                },
                'Vintage Hip Hop': {
                    kick: [1,0,0,0, 1,0,0,0, 1,0,0,0, 1,0,0,0], 
                    hihat: [0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1], 
                    snare: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                    kickFreq: 47, snareFreq: 190
                },
                'West Coast': {
                    kick: [1,0,0,0, 1,0,0,0, 1,0,0,0, 1,0,0,0], 
                    hihat: [1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1], 
                    snare: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                    kickFreq: 49, snareFreq: 210
                },
                'East Coast': {
                    kick: [1,0,0,0, 1,0,0,0, 1,0,0,0, 1,0,0,0], 
                    hihat: [0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1], 
                    snare: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                    kickFreq: 51, snareFreq: 205
                }
            };
            
            // Get pattern for selected kit or default to any_drums
            const selectedPattern = kitPatterns[actualDrumKit] || kitPatterns['any_drums'];
            const pattern = selectedPattern;
            
            // Get user's generation history for adaptive characteristics
            const userHistory = getUserGenerationHistory();
            const historyInfluence = calculateHistoryInfluence(userHistory, genre, mood);
            
            // Adaptive chord progressions based on settings and history
            const baseChords = {
                'Dark': [220, 246.94, 261.63, 293.66],
                'Chill': [261.63, 329.63, 392.00, 440.00],
                'Aggressive': [146.83, 164.81, 196.00, 220.00],
                'Melancholic': [174.61, 196.00, 220.00, 246.94],
                'Energetic': [293.66, 329.63, 369.99, 415.30]
            };
            
            // Modify chords based on complexity setting and history
            const complexity = beat.metadata?.settings?.complexity || 'intermediate';
            const chords = adaptChordsToSettings(baseChords[mood] || baseChords['Chill'], complexity, historyInfluence, tempo);
            

            const stepTime = (60 / tempo) / 4;
            
            for (let channel = 0; channel < buffer.numberOfChannels; channel++) {
                const channelData = buffer.getChannelData(channel);
                
                for (let i = 0; i < channelData.length; i++) {
                    const time = i / sampleRate;
                    const step = Math.floor(time / stepTime) % 16;
                    const bar = Math.floor(time / (stepTime * 16)) % 4;
                    let sample = 0;
                    
                    // DRUM KIT SPECIFIC KICK + BASS LINE
                    if (pattern.kick[step]) {
                        const kickFreq = pattern.kickFreq || 55;
                        const kickEnv = Math.exp(-time % stepTime * 15);
                        const kickClick = Math.exp(-time % stepTime * 80);
                        
                        // Kit-specific kick characteristics
                        sample += Math.sin(2 * Math.PI * kickFreq * time) * kickEnv * 0.8;
                        sample += Math.sin(2 * Math.PI * (kickFreq * 0.5) * time) * kickEnv * 0.6;
                        sample += Math.sin(2 * Math.PI * (kickFreq * 2) * time) * kickClick * 0.3;
                        sample += Math.sin(2 * Math.PI * (kickFreq * 1.5) * time) * kickEnv * 0.4;
                        
                        // BASS LINE for kicks
                        const bassNote = mood === 'Dark' ? 35 : mood === 'Aggressive' ? 40 : 42;
                        const bassEnv = Math.exp(-time % stepTime * 2.5);
                        sample += Math.sin(2 * Math.PI * bassNote * time) * bassEnv * 0.6;
                        sample += Math.sin(2 * Math.PI * (bassNote * 0.5) * time) * bassEnv * 0.4;
                    }
                    
                    // DRUM KIT SPECIFIC SNARE
                    if (pattern.snare[step]) {
                        const snareFreq = pattern.snareFreq || 220;
                        const snareEnv = Math.exp(-time % stepTime * 20);
                        const noise = (Math.random() * 2 - 1) * 0.8;
                        const crack = Math.exp(-time % stepTime * 50);
                        
                        sample += (Math.sin(2 * Math.PI * snareFreq * time) + noise) * snareEnv * 0.6;
                        sample += noise * crack * 0.4;
                    }
                    
                    // Hi-hat with swing
                    if (pattern.hihat[step]) {
                        const hihatEnv = Math.exp(-time % stepTime * 35);
                        const swing = step % 2 === 1 ? 0.7 : 1.0;
                        sample += (Math.random() * 2 - 1) * hihatEnv * 0.2 * swing;
                    }
                    
                    // 808 bass with pitch slides (reduced bass line when 808 is present)
                    const has808 = actualDrumKit.includes('808') || actualDrumKit.includes('TM88') || 
                                  actualDrumKit.includes('Metro Boomin') || actualDrumKit.includes('Lex Luger') || 
                                  actualDrumKit.includes('Pierre Bourne') || actualDrumKit.includes('Zaytoven') || 
                                  genre === 'Trap' || genre === 'Drill' || genre === 'Hip-Hop' || genre === 'Rap' || 
                                  genre === 'Gangsta' || genre === 'West Coast' || genre === 'East Coast' || 
                                  genre === 'Dirty South' || genre === 'Cloud Rap' || genre === 'Afrobeats' || 
                                  genre === 'Jersey Club' || genre === 'Phonk' || genre === 'Rage' || 
                                  genre === 'Memphis' || genre === 'Crunk' || genre === 'Hyphy' || 
                                  genre === 'G-Funk' || genre === 'Horrorcore' || genre === 'Industrial Hip-Hop' || 
                                  genre === 'Alternative Hip-Hop' || genre === 'Conscious Rap' || genre === 'Hardcore Hip-Hop' || 
                                  genre === 'EDM' || genre === 'Pop' || genre === 'Hyperpop' || genre === 'UK Drill';
                    
                    if (has808) {
                        if (pattern.kick[step] || (step % 4 === 2 && bar % 2 === 1)) {
                            const bassNote = mood === 'Dark' ? 40 : 45;
                            const bassEnv = Math.exp(-time % stepTime * 3);
                            const slideAmount = step % 8 === 6 ? 1.3 : step % 8 === 7 ? 0.8 : 1.0;
                            
                            // Main 808
                            sample += Math.sin(2 * Math.PI * bassNote * slideAmount * time) * bassEnv * 0.5;
                            sample += Math.sin(2 * Math.PI * (bassNote * 0.5) * slideAmount * time) * bassEnv * 0.3;
                            
                            // Reduced bass line for certain styles
                            const needsBassLine = mood === 'Melancholic' || mood === 'Chill' || 
                                                genre === 'Lo-Fi' || genre === 'Boom Bap' || 
                                                Math.random() < 0.3; // 30% chance for variety
                            
                            if (needsBassLine && step % 8 === 0) {
                                const subtleBass = bassNote * 0.75;
                                const subtleEnv = Math.exp(-time % stepTime * 1.8);
                                sample += Math.sin(2 * Math.PI * subtleBass * time) * subtleEnv * 0.2;
                            }
                        }
                    }
                    
                    // ADAPTIVE CHORD PROGRESSIONS based on settings and history
                    const chordStep = Math.floor(step / 4) % 4;
                    const rootNote = chords[chordStep];
                    
                    // Calculate adaptive note variations based on user preferences
                    const noteVariations = calculateNoteVariations(step, historyInfluence, complexity, mood, tempo);
                    
                    // Pad/melody with adaptive chord progressions
                    if (step % 8 === 0 || step % 8 === 4 || step % 8 === 6) {
                        const padEnv = Math.exp(-time % (stepTime * 2) * (1.2 + historyInfluence.decay));
                        const noteVariation = noteVariations.pitch;
                        
                        // Root note with history-influenced characteristics
                        sample += Math.sin(2 * Math.PI * rootNote * noteVariation * time) * padEnv * (0.12 + historyInfluence.volume);
                        
                        // Adaptive harmony based on complexity
                        if (complexity !== 'simple') {
                            const third = rootNote * (historyInfluence.harmony || 1.25992);
                            sample += Math.sin(2 * Math.PI * third * noteVariation * time) * padEnv * 0.08;
                            
                            if (complexity === 'expert') {
                                const fifth = rootNote * (historyInfluence.extended || 1.49831);
                                sample += Math.sin(2 * Math.PI * fifth * noteVariation * time) * padEnv * 0.06;
                            }
                        }
                    }
                    
                    // Adaptive one-shot melodic notes + additional bass line elements
                    if (step % 16 === 8 || step % 16 === 12) {
                        const noteEnv = Math.exp(-time % stepTime * (6 + historyInfluence.attack));
                        const pitchShift = noteVariations.melodic;
                        const melodyNote = rootNote * 2 * pitchShift;
                        
                        sample += Math.sin(2 * Math.PI * melodyNote * time) * noteEnv * (0.1 + historyInfluence.melody);
                        
                        // Additional bass line for non-808 tracks
                        if (!has808 && (step % 16 === 12)) {
                            const bassLineNote = rootNote * 0.5;
                            const bassLineEnv = Math.exp(-time % stepTime * 4);
                            sample += Math.sin(2 * Math.PI * bassLineNote * time) * bassLineEnv * 0.25;
                        }
                    }
                    
                    // Walking bass line for certain genres (when no 808)
                    if (!has808 && (genre === 'Jazz Rap' || genre === 'Boom Bap' || genre === 'East Coast')) {
                        if (step % 2 === 1) {
                            const walkingBass = rootNote * 0.6 * (1 + (step % 4) * 0.1);
                            const walkEnv = Math.exp(-time % stepTime * 3);
                            sample += Math.sin(2 * Math.PI * walkingBass * time) * walkEnv * 0.15;
                        }
                    }
                    
                    // Compression and saturation for more punch
                    sample = Math.tanh(sample * 2.2) * 0.9;
                    channelData[i] = sample;
                }
            }
            
            return buffer;
        }
        
        let currentAudioSource = null;
        let audioStartTime = 0;
        let audioDuration = 0;
        let isPlaying = false;
        
        function playBeat(beatId) {
            const beat = generatedBeats.find(b => b.id === beatId);
            if (beat) {
                // Check if this beat is currently playing
                const audio = document.getElementById('beatAudio');
                const isCurrentBeat = audio.src.includes(beat.audioUrl.split('/').pop());
                
                if (isCurrentBeat && !audio.paused) {
                    // Pause current beat
                    audio.pause();
                    document.getElementById('playBtn').textContent = 'â–¶ï¸';
                    isPlaying = false;
                    return;
                }
                
                // Stop any current audio
                stopCurrentAudio();
                
                // Try to use actual backend-generated file first
                audio.src = beat.audioUrl;
                
                audio.onloadeddata = () => {
                    // Backend file loaded successfully
                    document.getElementById('nowPlaying').textContent = beat.name;
                    document.getElementById('compactPlayer').style.display = 'flex';
                    audio.play();
                    document.getElementById('playBtn').textContent = 'â¸ï¸';
                    isPlaying = true;
                    showNotification(`Playing: ${beat.name}`);
                    
                    // Show duration when loaded
                    const totalMin = Math.floor(audio.duration / 60);
                    const totalSec = Math.floor(audio.duration % 60);
                    document.getElementById('timeDisplay').textContent = `0:00 / ${totalMin}:${totalSec.toString().padStart(2, '0')}`;
                };
                
                audio.onerror = () => {
                    // Fallback to generated audio if backend file not available
                    playGeneratedAudio(beat);
                };
                
                audio.onended = () => {
                    document.getElementById('playBtn').textContent = 'â–¶ï¸';
                    isPlaying = false;
                };
            }
        }
        
        function playGeneratedAudio(beat) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const buffer = generateBeatAudio(beat);
            
            currentAudioSource = audioContext.createBufferSource();
            currentAudioSource.buffer = buffer;
            currentAudioSource.connect(audioContext.destination);
            
            document.getElementById('nowPlaying').textContent = beat.name;
            document.getElementById('compactPlayer').style.display = 'flex';
            
            audioStartTime = audioContext.currentTime;
            audioDuration = buffer.duration;
            
            currentAudioSource.start(0);
            document.getElementById('playBtn').textContent = 'â¸ï¸';
            isPlaying = true;
            showNotification(`Playing: ${beat.name}`);
            
            updateAudioProgress();
            
            currentAudioSource.onended = () => {
                document.getElementById('playBtn').textContent = 'â–¶ï¸';
                document.getElementById('progressBar').style.width = '0%';
                document.getElementById('timeDisplay').textContent = '0:00';
                currentAudioSource = null;
                isPlaying = false;
            };
        }
        
        function stopCurrentAudio() {
            if (currentAudioSource) {
                currentAudioSource.stop();
                currentAudioSource = null;
            }
            
            const audio = document.getElementById('beatAudio');
            if (!audio.paused) {
                audio.pause();
                audio.currentTime = 0;
            }
            
            document.getElementById('playBtn').textContent = 'â–¶ï¸';
            document.getElementById('compactProgressBar').style.width = '0%';
            document.getElementById('timeDisplay').textContent = '0:00';
            isPlaying = false;
        }
        
        function updateAudioProgress() {
            if (currentAudioSource) {
                const audioContext = currentAudioSource.context;
                const elapsed = audioContext.currentTime - audioStartTime;
                const progress = Math.min((elapsed / audioDuration) * 100, 100);
                
                document.getElementById('compactProgressBar').style.width = progress + '%';
                
                const minutes = Math.floor(elapsed / 60);
                const seconds = Math.floor(elapsed % 60);
                const totalMin = Math.floor(audioDuration / 60);
                const totalSec = Math.floor(audioDuration % 60);
                document.getElementById('timeDisplay').textContent = `${minutes}:${seconds.toString().padStart(2, '0')} / ${totalMin}:${totalSec.toString().padStart(2, '0')}`;
                
                if (elapsed < audioDuration) {
                    requestAnimationFrame(updateAudioProgress);
                }
            }
        }
        
        function updateProgress() {
            const audio = document.getElementById('beatAudio');
            const progressBar = document.getElementById('compactProgressBar');
            const timeDisplay = document.getElementById('timeDisplay');
            
            if (audio.duration && !audio.paused) {
                const progress = (audio.currentTime / audio.duration) * 100;
                progressBar.style.width = progress + '%';
                
                const currentMin = Math.floor(audio.currentTime / 60);
                const currentSec = Math.floor(audio.currentTime % 60);
                const totalMin = Math.floor(audio.duration / 60);
                const totalSec = Math.floor(audio.duration % 60);
                
                timeDisplay.textContent = `${currentMin}:${currentSec.toString().padStart(2, '0')} / ${totalMin}:${totalSec.toString().padStart(2, '0')}`;
            }
        }
        
        function updateTempo() {
            const tempo = document.getElementById('tempo').value;
            document.getElementById('tempoValue').textContent = tempo;
            calculateTime();
        }
        
        function updateLength() {
            const length = document.getElementById('length').value;
            document.getElementById('lengthValue').textContent = length;
            calculateTime();
        }
        
        function calculateTime() {
            const tempo = parseInt(document.getElementById('tempo').value);
            const length = parseInt(document.getElementById('length').value);
            
            // Calculate time: (bars * 4 beats/bar * 60 seconds/minute) / tempo
            const timeInSeconds = (length * 4 * 60) / tempo;
            const minutes = Math.floor(timeInSeconds / 60);
            const seconds = Math.floor(timeInSeconds % 60);
            
            document.getElementById('tempoTime').textContent = `(${minutes}:${seconds.toString().padStart(2, '0')})`;
            document.getElementById('lengthTime').textContent = `(${minutes}:${seconds.toString().padStart(2, '0')})`;
        }
        
        function addBeatToList(data, payload) {
            const beatsContainer = document.getElementById('beats');
            const beatDiv = document.createElement('div');
            beatDiv.className = 'beat-item';
            
            const beatId = (Date.now() + Math.random()).toString();
            const beatName = payload.custom_name || `Beat_${Date.now()}`;
            const now = new Date();
            const dateStr = now.toLocaleString();
            
            const beat = {
                id: beatId,
                name: beatName,
                audioUrl: `http://localhost:5050/generated_beats/${data.beat_file}`,
                samples: data.samples_used || 'Various',
                date: dateStr,
                tempo: payload.tempo,
                length: payload.bars
            };
            
            generatedBeats.unshift(beat);
            
            // Store full metadata with ACTUAL samples used
            const actualSamples = data.sample_details ? 
                data.sample_details.map(s => s.filename || s.name) : 
                generateUniqueSampleNames(payload);
            
            const aiMode = payload.ai_learning_mode || 'off';
            const aiModeText = aiMode === 'active' ? 'ğŸ”¥ AI-Enhanced Generation' : 
                              aiMode === 'passive' ? 'ğŸ§  AI-Learning Generation' : 
                              'Standard Generation';
            
            beat.metadata = {
                settings: {
                    genre: payload.genre || 'Random',
                    mood: payload.mood || 'Random',
                    tempo: data.ai_enhanced ? data.ai_tempo : (payload.tempo || 120),
                    length: payload.bars || 32,
                    complexity: payload.complexity || 'intermediate',
                    mode: payload.mode || 'inputs',
                    styleEra: payload.style?.includes('old_school') ? 'Old School' : 'Modern',
                    audioAnalysis: payload.audio_analysis ? 'Content Analysis' : 'Filename Matching',
                    aiEnhanced: data.ai_enhanced || aiMode !== 'off',
                    drumKit: payload.drum_kit || 'default',
                    actualKit: payload.drum_kit || document.getElementById('drumKit').value
                },
                eq: payload.eq || { low: 0, mid: 0, high: 0 },
                keywords: payload.keyword || payload.description || 'None',
                concept: payload.concept || 'N/A',
                samplesUsed: actualSamples,
                aiTraining: aiModeText
            };
            
            beatDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1;">
                        <h3 style="color: #ffd700; margin: 0;">${beat.name}</h3>
                        <p style="color: #ccc; margin: 5px 0; font-size: 12px;">${beat.date}</p>
                        <p style="color: #888; font-size: 11px;">${beat.tempo} BPM â€¢ ${beat.length} bars â€¢ Samples: ${beat.samples}</p>
                    </div>
                    <button class="expand-btn" onclick="toggleMetadata('${beatId}')">Details â–¼</button>
                    <button onclick="playBeat('${beatId}')" style="padding: 8px 16px; background: #4caf50; color: white; border: none; border-radius: 20px; cursor: pointer; margin-right: 10px;">â–¶ï¸ Play</button>
                    <button onclick="downloadBeat('${data.beat_file}')" style="padding: 8px 16px; background: #2196F3; color: white; border: none; border-radius: 20px; cursor: pointer;">ğŸ“¥ Download</button>
                </div>
                
                <div id="metadata-${beatId}" class="beat-metadata">
                    <div class="metadata-grid">
                        <div class="metadata-section">
                            <div class="metadata-title">ğŸµ Generation Settings</div>
                            <div class="metadata-item">Genre: ${beat.metadata.settings.genre}</div>
                            <div class="metadata-item">Mood: ${beat.metadata.settings.mood}</div>
                            <div class="metadata-item">Mode: ${beat.metadata.settings.mode}</div>
                            <div class="metadata-item">Style Era: ${beat.metadata.settings.styleEra}</div>
                            <div class="metadata-item">Complexity: ${beat.metadata.settings.complexity}</div>
                            <div class="metadata-item">Analysis: ${beat.metadata.settings.audioAnalysis}</div>
                        </div>
                        
                        <div class="metadata-section">
                            <div class="metadata-title">ğŸ¹ Audio Settings</div>
                            <div class="metadata-item">Tempo: ${beat.metadata.settings.tempo} BPM</div>
                            <div class="metadata-item">Length: ${beat.metadata.settings.length} bars</div>
                            <div class="metadata-item">EQ Low: ${beat.metadata.eq.low} dB</div>
                            <div class="metadata-item">EQ Mid: ${beat.metadata.eq.mid} dB</div>
                            <div class="metadata-item">EQ High: ${beat.metadata.eq.high} dB</div>
                        </div>
                    </div>
                    
                    <div class="metadata-section">
                        <div class="metadata-title">ğŸ§ Samples Used</div>
                        ${beat.metadata.samplesUsed.map(sample => `<div class="metadata-item">â€¢ ${sample}</div>`).join('')}
                    </div>
                    
                    <div class="metadata-section" style="margin-top: 10px;">
                        <div class="metadata-title">ğŸ“ Keywords & Description</div>
                        <div class="metadata-item">${beat.metadata.keywords}</div>
                        ${beat.metadata.concept !== 'N/A' ? `<div class="metadata-item">Concept: ${beat.metadata.concept}</div>` : ''}
                        <div class="metadata-item" style="color: ${beat.metadata.settings.aiEnhanced ? '#4CAF50' : '#888'}; font-weight: bold;">
                            AI Mode: ${beat.metadata.aiTraining}
                        </div>
                    </div>
                </div>
            `;
            
            beatsContainer.insertBefore(beatDiv, beatsContainer.firstChild);
            updateFileLibrary();
            return beatId;
        }
        


        function getTheme() {
            return themes[currentTheme] || themes['dark-gold'];
        }

        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            if (event && event.target) event.target.classList.add('active');
            
            if (tabName === 'analytics') loadAnalytics();
            if (tabName === 'ailearning') loadAILearning();
            if (tabName === 'notifications') loadNotifications();
            if (tabName === 'accounts') {
                loadAccounts();
                if (userLevel <= 2) {
                    currentAccountFilter = 'active';
                }
            }
            if (tabName === 'proposals') loadProposals();
        }

        // Beat Mode Toggle
        function toggleAdvancedOptions() {
            const mode = document.getElementById('beatMode').value;
            const advanced = document.getElementById('advancedSampling');
            const creative = document.getElementById('creativeControls');
            
            if (mode === 'creative') {
                advanced.classList.add('hidden');
                creative.classList.remove('hidden');
            } else if (mode === 'inputs') {
                advanced.classList.remove('hidden');
                creative.classList.add('hidden');
            } else {
                advanced.classList.add('hidden');
                creative.classList.add('hidden');
            }
        }

        // Status Management
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.innerHTML = message;
            status.className = 'status ' + type;
            if (type !== 'error') {
                setTimeout(() => status.innerHTML = '', 3000);
            }
        }

        // Beat Generation with progress bar and sound
        async function generateBeat() {
            const mode = document.getElementById('beatMode').value;
            
            // Start progress bar
            showProgressBar();
            showStatus('ğŸµ Generating beat...', 'info');

            const timestamp = Date.now();
            const randomSeed = Math.random();
            const sessionId = Math.random().toString(36).substring(2, 15);
            const microTime = performance.now();
            
            const payload = {
                style: `${document.getElementById('styleEra').value}_${document.getElementById('genre').value.toLowerCase()}`,
                tempo: parseInt(document.getElementById('tempo').value) + Math.floor(Math.random() * 5 - 2), // Â±2 BPM variation
                bars: parseInt(document.getElementById('length').value),
                keyword: document.getElementById('samplingKeyword').value || document.getElementById('description').value,
                eq: {
                    low: parseInt(document.getElementById('eqLow').value),
                    mid: parseInt(document.getElementById('eqMid').value),
                    high: parseInt(document.getElementById('eqHigh').value)
                },
                description: document.getElementById('description').value,
                mode: mode,
                custom_name: generateBeatName(),
                audio_analysis: document.getElementById('audioAnalysis').value === 'content',
                genre: document.getElementById('genre').value,
                mood: document.getElementById('mood').value,
                complexity: document.getElementById('complexity').value,
                ai_learning_enabled: aiLearningEnabled,
                ai_learning_mode: document.getElementById('aiLearningMode').value,
                drum_kit: document.getElementById('drumKit').value,
                actual_kit_used: document.getElementById('drumKit').value,
                timestamp: timestamp,
                random_seed: randomSeed,
                variation_factor: Math.random(),
                force_new_samples: true,
                sample_diversity: 'maximum',
                creative_mode: true,
                studio_quality: true,
                producer_level: 'professional',
                force_unique: true,
                session_id: sessionId,
                micro_time: microTime,
                entropy_seed: Math.random() * 1000000,
                pattern_shift: Math.floor(Math.random() * 16),
                swing_factor: 0.5 + (Math.random() * 0.3),
                force_different_samples: true,
                randomize_order: true,
                avoid_recent_samples: true,
                sample_exclusion_list: generatedBeats.slice(-8).map(b => b.samples).flat(),
                beat_exclusion_list: generatedBeats.slice(-5).map(b => b.name),
                generation_count: generatedBeats.length + 1,
                force_new_pattern: true,
                randomize_sample_start: true,
                shuffle_layers: true,
                vary_velocities: true,
                random_effects: true,
                enable_vocal_processing: true,
                vocal_isolation: true,
                acapella_extraction: true,
                instrumental_separation: true,
                use_full_songs: true,
                vocal_content_type: document.getElementById('vocalContent').value,
                process_vocals: document.getElementById('audioAnalysis').value === 'content',
                apply_to_all_catalogs: true,
                chosen1_vocal_processing: true,
                jintsu_vocal_processing: true,
                drumkits_vocal_processing: true,
                beat_variation_seed: Math.random() * 999999,
                sample_randomization: Math.random(),
                pattern_randomization: Math.random(),
                disable_synthetic_generation: true,
                force_real_samples: true,
                require_catalog_samples: true,
                no_fallback_generation: true,
                sample_priority: 'catalog_only',
                ai_learning_influence: document.getElementById('aiLearningMode').value,
                sample_count: 50,
                improve_drum_detection: true,
                prioritize_drum_samples: true,
                expand_sample_search: true,
                better_categorization: true,
                include_drum_keywords: ['kick', 'snare', 'hihat', 'hat', 'clap', 'perc', '808', 'bass', 'drum'],
                jintsu_path_correct: 'C:\\Users\\Jintsu\\Desktop\\JINTSU CATALOG',
                unique_id: `${timestamp}_${randomSeed}_${sessionId}_${microTime}_${Math.random()}`
            };

            if (mode === 'creative') {
                payload.concept = document.getElementById('beatConcept').value;
                payload.era = document.getElementById('styleEra').value;
                payload.intensity = document.getElementById('complexity').value;
            }

            try {
                updateProgress(25, 'Connecting to backend...');
                
                const endpoint = mode === 'creative' ? 'generate_creative_beat' : 'generate_beat';
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout
                
                const response = await fetch(`http://localhost:5050/${endpoint}`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                updateProgress(75, 'Backend processing...');
                
                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }
                
                const data = await response.json();
                updateProgress(100, 'Complete!');

                if (data.status === 'success') {
                    hideProgressBar();
                    showStatus('âœ… Beat generated successfully!', 'success');
                    
                    // Ensure beat uniqueness
                    const uniqueSignature = ensureBeatUniqueness(payload.unique_id);
                    data.unique_signature = uniqueSignature;
                    
                    const beatId = addBeatToList(data, payload);
                    showNotification('ğŸµ Unique studio-quality beat generated!');
                    
                    if (currentUser) {
                        saveUserAnalytics();
                        updateGenerationHistory(
                            payload.genre,
                            payload.mood,
                            payload.complexity,
                            payload.tempo
                        );
                    }
                } else {
                    hideProgressBar();
                    showStatus('âŒ ' + (data.error || 'Beat generation failed'), 'error');
                    showNotification('Beat generation failed', 'error');
                }
            } catch (error) {
                hideProgressBar();
                if (error.name === 'AbortError') {
                    showStatus('ğŸµ Generating professional beat...', 'info');
                    generateProfessionalBeat(payload);
                } else {
                    showStatus('ğŸµ Generating professional beat...', 'info');
                    generateProfessionalBeat(payload);
                }
            }
        }

        // Puter AI Chat (Enhanced with Fallback)
        async function sendChat() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addChatMessage('You', message);
            input.value = '';

            try {
                const response = await fetch('http://localhost:5050/puter_chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: message,
                        context: document.getElementById('chatContext').value
                    })
                });

                const data = await response.json();
                if (data.status === 'success') {
                    addChatMessage('Puter AI', data.response);
                } else {
                    generateFallbackResponse(message);
                }
            } catch (error) {
                generateFallbackResponse(message);
            }
        }
        
        function generateFallbackResponse(message) {
            const context = document.getElementById('chatContext').value;
            const lowerMessage = message.toLowerCase();
            let response = '';
            
            // Context-based responses
            if (context === 'beat') {
                if (lowerMessage.includes('tempo') || lowerMessage.includes('bpm')) {
                    response = 'For beat tempo: Trap/Drill (140-180 BPM), Hip-Hop (80-140 BPM), Boom Bap (90-110 BPM). Slower tempos feel more laid back, faster tempos create energy.';
                } else if (lowerMessage.includes('kick') || lowerMessage.includes('drum')) {
                    response = 'Kick drums are the foundation. Place them on beats 1 and 3 for classic patterns, or try syncopated patterns for modern trap. Layer with 808s for sub-bass.';
                } else if (lowerMessage.includes('sample')) {
                    response = 'When sampling: chop at transients, use EQ to fit the mix, and try pitch shifting for different moods. Always clear samples legally!';
                } else {
                    response = 'I can help with beat structure, drum patterns, sampling techniques, and arrangement. What specific aspect of beat making interests you?';
                }
            } else if (context === 'lyrics') {
                if (lowerMessage.includes('rhyme') || lowerMessage.includes('flow')) {
                    response = 'For better flow: match syllables to beat subdivisions, use internal rhymes, and vary your cadence. Practice with a metronome to stay on beat.';
                } else if (lowerMessage.includes('structure')) {
                    response = 'Common rap structure: Intro â†’ Verse â†’ Hook â†’ Verse â†’ Hook â†’ Bridge â†’ Hook â†’ Outro. Each section should be 8-16 bars typically.';
                } else {
                    response = 'I can help with rhyme schemes, song structure, wordplay techniques, and flow patterns. What aspect of lyricism are you working on?';
                }
            } else if (context === 'music') {
                if (lowerMessage.includes('chord') || lowerMessage.includes('harmony')) {
                    response = 'Popular chord progressions: vi-IV-I-V (Am-F-C-G), I-V-vi-IV (C-G-Am-F). Minor chords create darker moods, major chords sound brighter.';
                } else if (lowerMessage.includes('scale') || lowerMessage.includes('key')) {
                    response = 'Common scales for hip-hop: Natural minor (dark/emotional), Dorian mode (jazzy), Pentatonic (simple/catchy). Start with C minor or A minor.';
                } else if (lowerMessage.includes('mix') || lowerMessage.includes('eq')) {
                    response = 'Mixing tips: High-pass vocals around 80Hz, boost kick around 60Hz, cut muddy frequencies around 200-500Hz. Use compression on drums for punch.';
                } else {
                    response = 'I can help with music theory, mixing, sound design, and production techniques. What production topic interests you?';
                }
            } else if (context === 'features') {
                if (lowerMessage.includes('suggest') || lowerMessage.includes('feature') || lowerMessage.includes('idea')) {
                    response = 'Excellent! I love feature suggestions. What specific functionality would you like to see? Popular ideas: real-time collaboration, voice-to-beat generation, advanced swing controls, MIDI export, or custom sample packs. What\'s your vision?';
                } else if (lowerMessage.includes('improve') || lowerMessage.includes('better') || lowerMessage.includes('enhance')) {
                    response = 'Great thinking! Areas we could improve: ğŸµ Beat generation (more genres, better AI), ğŸ›ï¸ Sampling (auto-chop, pitch detection), ğŸ¨ UI/UX (dark themes, shortcuts), ğŸ“± Mobile version, or ğŸŒ Cloud sync. Which interests you?';
                } else if (lowerMessage.includes('collaboration') || lowerMessage.includes('multiplayer') || lowerMessage.includes('together')) {
                    response = 'Real-time collaboration would be amazing! Imagine: shared beat sessions, live editing, voice chat, version control, and collaborative playlists. Technical challenges: sync latency, conflict resolution. Thoughts on implementation?';
                } else if (lowerMessage.includes('mobile') || lowerMessage.includes('phone') || lowerMessage.includes('app')) {
                    response = 'Mobile version is a great idea! Features could include: touch-based beat pads, simplified UI, cloud sync with desktop, offline mode, and social sharing. React Native or Flutter for cross-platform. What mobile features excite you most?';
                } else if (lowerMessage.includes('ai') || lowerMessage.includes('smart') || lowerMessage.includes('intelligent')) {
                    response = 'AI enhancements could revolutionize beat making! Ideas: style transfer (make any beat sound like Drake), auto-mastering, intelligent sample suggestions, mood-based generation, or lyrics-to-beat conversion. What AI feature would help your workflow?';
                } else if (lowerMessage.includes('export') || lowerMessage.includes('midi') || lowerMessage.includes('stems')) {
                    response = 'Export improvements are crucial for professional workflow! Ideas: MIDI export, individual stem separation, multiple formats (WAV/MP3/FLAC), project files for DAWs, or direct upload to streaming platforms. What export feature do you need most?';
                } else if (lowerMessage.includes('social') || lowerMessage.includes('share') || lowerMessage.includes('community')) {
                    response = 'Social features could build an amazing community! Ideas: beat battles, remix challenges, producer profiles, collaborative playlists, feedback system, or marketplace for beats. How do you envision the social aspect?';
                } else if (lowerMessage.includes('ui') || lowerMessage.includes('interface') || lowerMessage.includes('design')) {
                    response = 'UI/UX improvements can make or break an app! Ideas: customizable layouts, keyboard shortcuts, drag-and-drop workflow, visual waveforms, color-coded elements, or accessibility features. What interface element frustrates you most?';
                } else if (lowerMessage.includes('sample') || lowerMessage.includes('library') || lowerMessage.includes('sounds')) {
                    response = 'Sample management is key for producers! Ideas: AI-powered sample discovery, auto-tagging by mood/genre, smart recommendations, cloud sample library, or integration with sample sites. What sampling workflow would you love?';
                } else if (lowerMessage.includes('performance') || lowerMessage.includes('speed') || lowerMessage.includes('optimization')) {
                    response = 'Performance optimization is crucial! Areas: faster beat generation, real-time preview, background processing, memory optimization, or GPU acceleration. What performance issue do you experience most?';
                } else if (lowerMessage.includes('plugin') || lowerMessage.includes('vst') || lowerMessage.includes('integration')) {
                    response = 'DAW integration would be powerful! Ideas: VST plugin version, Ableton Link sync, FL Studio integration, or direct project export to popular DAWs. Which DAW do you use most? How would integration help your workflow?';
                } else {
                    response = 'I can help develop feature ideas for AiBeatzbyJyntzu! Popular categories: ğŸ¤– AI enhancements, ğŸ‘¥ Collaboration tools, ğŸ“± Mobile features, ğŸ›ï¸ Advanced sampling, ğŸ¨ UI improvements, ğŸŒ Social features. What interests you most?';
                }
            } else if (context === 'keywords') {
                if (lowerMessage.includes('tag') || lowerMessage.includes('tags') || lowerMessage.includes('tagging')) {
                    response = 'Smart tagging is crucial for beat discovery! Ideas: auto-genre detection, mood analysis, BPM detection, key detection, energy level tagging, or instrument recognition. What tagging features would help organize your beats?';
                } else if (lowerMessage.includes('search') || lowerMessage.includes('find') || lowerMessage.includes('discovery')) {
                    response = 'Beat search and discovery! Features: semantic search ("dark piano trap"), similarity matching, mood-based filtering, BPM range search, or AI-powered recommendations. How do you currently search for beats?';
                } else if (lowerMessage.includes('genre') || lowerMessage.includes('style') || lowerMessage.includes('category')) {
                    response = 'Genre classification is key! We have 33+ genres: Trap, Drill, Boom Bap, Lo-Fi, etc. Ideas: sub-genre detection, fusion genres, regional styles, or custom genre creation. Which genres do you produce most?';
                } else if (lowerMessage.includes('mood') || lowerMessage.includes('emotion') || lowerMessage.includes('vibe')) {
                    response = 'Mood keywords enhance beat selection! Current moods: Dark, Chill, Aggressive, Energetic, Melancholic, etc. Ideas: emotion detection from audio, custom mood creation, or mood transitions. What moods inspire your beats?';
                } else if (lowerMessage.includes('instrument') || lowerMessage.includes('sound') || lowerMessage.includes('sample')) {
                    response = 'Instrument/sound tagging helps producers find specific elements! Ideas: piano, guitar, vocal, 808, synth detection, or custom sound categories. What instruments do you use most in your beats?';
                } else if (lowerMessage.includes('bpm') || lowerMessage.includes('tempo') || lowerMessage.includes('speed')) {
                    response = 'Tempo-based keywords are essential! Current range: 60-180 BPM. Ideas: auto-BPM detection, tempo matching, speed categories (slow/medium/fast), or tempo change detection. What BPM ranges do you prefer?';
                } else if (lowerMessage.includes('key') || lowerMessage.includes('scale') || lowerMessage.includes('pitch')) {
                    response = 'Musical key detection helps with harmonic matching! Ideas: auto-key detection, scale identification, chord progression analysis, or key compatibility suggestions. Do you pay attention to musical keys in your beats?';
                } else if (lowerMessage.includes('energy') || lowerMessage.includes('intensity') || lowerMessage.includes('level')) {
                    response = 'Energy level tagging helps match beats to activities! Ideas: low/medium/high energy detection, intensity curves, dynamic range analysis, or workout/chill categorization. How do you categorize beat energy?';
                } else if (lowerMessage.includes('custom') || lowerMessage.includes('personal') || lowerMessage.includes('user')) {
                    response = 'Custom keywords let producers create personal organization systems! Ideas: user-defined tags, personal collections, custom categories, or collaborative tagging. How would you organize your beats personally?';
                } else if (lowerMessage.includes('auto') || lowerMessage.includes('automatic') || lowerMessage.includes('ai')) {
                    response = 'AI-powered auto-tagging saves time! Features: audio analysis for automatic genre/mood/BPM detection, machine learning from user preferences, or smart suggestions. Would you trust AI to tag your beats?';
                } else if (lowerMessage.includes('organize') || lowerMessage.includes('sort') || lowerMessage.includes('filter')) {
                    response = 'Organization and filtering make large beat libraries manageable! Ideas: multi-tag filtering, smart playlists, date/popularity sorting, or advanced search operators. How do you currently organize your beats?';
                } else {
                    response = 'I can help with keywords and tagging systems! Areas: ğŸ·ï¸ Auto-tagging, ğŸµ Genre classification, ğŸ˜Š Mood detection, ğŸ¹ Instrument recognition, âš¡ Energy analysis, ğŸ” Smart search. What keyword feature interests you?';
                }
            } else {
                // General responses
                if (lowerMessage.includes('hi') || lowerMessage.includes('hello') || lowerMessage.includes('hey')) {
                    response = 'Hey! I\'m Puter AI, your music production assistant. I can help with beats, lyrics, music theory, mixing tips, or app feature ideas. What would you like to explore?';
                } else if (lowerMessage.includes('help')) {
                    response = 'I can assist with: ğŸµ Beat making techniques, ğŸ“ Lyric writing, ğŸ¹ Music theory, ğŸ›ï¸ Production tips, ğŸ’¡ Feature suggestions. What interests you most?';
                } else if (lowerMessage.includes('thank')) {
                    response = 'You\'re welcome! Happy to help with your music production journey. Feel free to ask about anything related to beats, production, or creative ideas!';
                } else {
                    response = 'I\'m here to help with music production! Try asking about beat patterns, chord progressions, mixing techniques, or suggest new features for the app. What\'s on your mind?';
                }
            }
            
            // Add contextual suggestions
            if (context === 'beat' && !lowerMessage.includes('tempo') && !lowerMessage.includes('kick')) {
                response += ' Try asking about tempo, drum patterns, or sampling techniques!';
            } else if (context === 'features') {
                if (!lowerMessage.includes('suggest') && !lowerMessage.includes('ai') && !lowerMessage.includes('mobile')) {
                    response += ' Popular topics: AI features, mobile app, collaboration tools, or UI improvements!';
                }
            } else if (context === 'keywords') {
                if (!lowerMessage.includes('tag') && !lowerMessage.includes('search') && !lowerMessage.includes('mood')) {
                    response += ' Popular topics: auto-tagging, genre classification, mood detection, or smart search!';
                }
            }
            
            addChatMessage('Puter AI', response);
        }

        function addChatMessage(sender, text) {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.style.marginBottom = '15px';
            messageDiv.innerHTML = `
                <div style="font-weight: bold; color: ${sender === 'You' ? '#ffd700' : sender === 'Puter AI' ? '#4caf50' : '#f44336'}; margin-bottom: 5px;">
                    ${sender === 'You' ? 'ğŸ‘¤' : sender === 'Puter AI' ? 'ğŸ¤–' : 'âš ï¸'} ${sender}
                </div>
                <div style="color: #ccc; line-height: 1.4;">${text}</div>
            `;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // Download Beat
        function downloadBeat(fileName) {
            const link = document.createElement('a');
            link.href = `http://localhost:5050/generated_beats/${fileName}`;
            link.download = fileName;
            link.click();
            showNotification('ğŸ’¾ Beat download started...', 'success');
        }
        
        // Sampling Functions
        function applySamplingToStudio() {
            document.getElementById('styleEra').value = document.getElementById('samplingStyle').value.includes('old_school') ? 'old_school' : 'modern';
            document.getElementById('beatMode').value = 'inputs';
            toggleAdvancedOptions();
            showTab('studio');
            showNotification('ğŸ›ï¸ Sampling settings applied to Studio');
        }
        
        function unapplySamplingFromStudio() {
            document.getElementById('styleEra').value = 'modern';
            document.getElementById('beatMode').value = 'inputs';
            document.getElementById('choppingMethod').value = 'auto';
            document.getElementById('samplingStyle').value = 'modern_trap';
            toggleAdvancedOptions();
            showTab('studio');
            showNotification('âŒ Sampling settings reset in Studio');
        }
        
        function addSampleCatalog() {
            addLibraryCatalog();
        }

        // Load Functions
        async function loadAnalytics() {
            if (userLevel <= 2) {
                const activeUsers = onlineUsers.filter(u => u.username !== 'admin').length + 1; // +1 for admin
                const inactiveUsers = userAccounts.filter(u => u.status === 'inactive').length;
                const adminUsers = onlineUsers.filter(u => u.level <= 2).length;
                
                const grid = document.getElementById('analyticsGrid');
                grid.innerHTML = `
                    <div class="analytics-card">
                        <h3 style="color: #ffd700;">ğŸš€ Performance</h3>
                        <p>Platform: Electron Desktop</p>
                        <p>Status: <span style="color: #4CAF50;">Running</span></p>
                        <p>Version: 1.0.0</p>
                    </div>
                    <div class="analytics-card">
                        <h3 style="color: #ffd700;">ğŸ“ˆ Usage</h3>
                        <p>Beats Generated: ${generatedBeats.length}</p>
                        <p>Session Time: ${Math.floor((Date.now() - sessionStart) / 60000)}m</p>
                        <p>Mode: Desktop App</p>
                    </div>
                    <div class="analytics-card">
                        <h3 style="color: #ffd700;">ğŸ‘¥ User Management</h3>
                        <p>Total Users: ${onlineUsers.length}</p>
                        <p>Active Users: ${activeUsers}</p>
                        <p>Inactive Users: ${inactiveUsers}</p>
                        <p>Admin Users: ${adminUsers}</p>
                    </div>
                    <div class="analytics-card">
                        <h3 style="color: #ffd700;">ğŸ’¾ Files</h3>
                        <p>Generated Beats: ${generatedBeats.length}</p>
                        <p>Total Files: ${generatedBeats.length}</p>
                        <p>Storage Used: ${(generatedBeats.length * 5).toFixed(1)} MB</p>
                    </div>
                `;
            }
        }
        
        function loadAILearning() {
            // AI Learning tab is accessible to all users
            updateAILearningDisplay();
            loadTrainingStats();
        }
        
        function sendLiveNotification() {
            if (userLevel !== 1) {
                showNotification('Owner Admin access required', 'error');
                return;
            }
            
            const type = document.getElementById('notificationType').value;
            const target = document.getElementById('notificationTarget').value;
            const title = document.getElementById('notificationTitle').value.trim();
            const message = document.getElementById('notificationMessage').value.trim();
            
            if (!title || !message) {
                showNotification('Title and message are required', 'error');
                return;
            }
            
            // Prevent duplicate notifications
            if (notificationHistory.find(n => n.title === title && n.message === message)) {
                showNotification('Duplicate notification prevented', 'warning');
                return;
            }
            
            const notification = {
                id: Date.now(),
                type: type,
                target: target,
                title: title,
                message: message,
                timestamp: new Date().toLocaleString(),
                sender: currentUser
            };
            
            // Add to history
            notificationHistory.unshift(notification);
            updateNotificationHistory();
            
            // Simulate sending (in production, this would call your server)
            showNotification(`ğŸš€ Notification sent to ${target}`, 'success');
            
            // Clear form
            document.getElementById('notificationTitle').value = '';
            document.getElementById('notificationMessage').value = '';
            
            // Update stats
            updateNotificationStats();
        }
        
        function previewNotification() {
            const title = document.getElementById('notificationTitle').value.trim();
            const message = document.getElementById('notificationMessage').value.trim();
            
            if (!title || !message) {
                showNotification('Enter title and message to preview', 'warning');
                return;
            }
            
            // Show preview as actual notification
            showNotification(`${title}: ${message}`, 'success');
        }
        
        function updateNotificationHistory() {
            const historyDiv = document.getElementById('notificationHistory');
            
            if (notificationHistory.length === 0) {
                historyDiv.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">No notifications sent yet</p>';
                return;
            }
            
            historyDiv.innerHTML = notificationHistory.slice(0, 10).map(notif => `
                <div class="beat-item" style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div style="flex: 1;">
                            <h4 style="color: #ffd700; margin: 0; font-size: 14px;">${notif.title}</h4>
                            <p style="color: #ccc; margin: 5px 0; font-size: 12px;">${notif.message}</p>
                            <p style="color: #888; font-size: 10px;">To: ${notif.target} â€¢ ${notif.timestamp}</p>
                        </div>
                        <span style="background: #4CAF50; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px;">${notif.type}</span>
                    </div>
                </div>
            `).join('');
        }
        
        function updateNotificationStats() {
            const today = new Date().toDateString();
            const todayNotifications = notificationHistory.filter(n => 
                new Date(n.timestamp).toDateString() === today
            ).length;
            
            document.getElementById('totalNotifications').textContent = todayNotifications;
            document.getElementById('activeUsersCount').textContent = onlineUsers.length;
        }

        async function loadAccounts() {
            // Use offline data only
            console.log('Offline mode - using local user data');
            if (userLevel <= 2) {
                showActiveUsers();
            } else {
                showActiveUsers();
            }
        }
        
        function showActiveUsers() {
            currentAccountFilter = 'active';
            updateFilterButtons();
            
            if (userLevel <= 2) {
                // Admin sees all users with online status
                const list = document.getElementById('accountsList');
                
                // Always show admin account first
                const defaultUsers = [
                    {
                        username: 'admin',
                        role: 'owner_admin',
                        level: 1,
                        ip: 'Local',
                        location: 'Desktop App',
                        login_time: new Date().toISOString(),
                        last_seen: new Date().toISOString()
                    }
                ];
                
                const allUsers = [...defaultUsers, ...onlineUsers.filter(u => u.username !== 'admin')];
                
                if (allUsers.length === 0) {
                    list.innerHTML = `
                        <div class="beat-item">
                            <p style="text-align: center; color: #888; font-style: italic;">No users currently online</p>
                        </div>
                    `;
                    return;
                }
                
                list.innerHTML = allUsers.map(user => {
                    const isOnline = user.last_seen && (Date.now() - new Date(user.last_seen).getTime()) < 60000;
                    const userLevelIcon = user.level === 1 ? 'ğŸ‘‘' : user.level === 2 ? 'ğŸ›¡ï¸' : 'ğŸ‘¤';
                    const userLevelName = user.level === 1 ? 'Owner Admin' : user.level === 2 ? 'Employee Admin' : 'User';
                    const canModify = userLevel === 1 && user.username !== 'admin'; // Only Owner Admin can modify others
                    
                    return `
                        <div class="beat-item">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div style="flex: 1;">
                                    <h3 style="color: #ffd700; margin: 0;">
                                        ${user.username} ${userLevelIcon}
                                        ${isOnline ? '<span style="color: #4CAF50;">ğŸŸ¢</span>' : '<span style="color: #888;">âš«</span>'}
                                    </h3>
                                    <p style="color: #ccc; margin: 5px 0; font-size: 12px;">Level ${user.level || 3}: ${userLevelName}</p>
                                    ${user.password && (user.username === currentUser || userLevel === 1) ? `<p style="color: #888; font-size: 11px;">Password: <span id="pass-${user.username}" style="font-family: monospace;">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span> <button onclick="togglePassword('${user.username}', '${user.password}')" style="background: none; border: none; color: #ffd700; cursor: pointer; font-size: 10px;">ğŸ‘ï¸</button></p>` : ''}
                                    <p style="color: #888; font-size: 11px;">IP: ${user.ip || 'Unknown'} â€¢ Location: ${user.location || 'Unknown'}</p>
                                    <p style="color: #888; font-size: 11px;">Login: ${user.login_time || 'Unknown'} â€¢ Last Seen: ${user.last_seen || 'Unknown'}</p>
                                    <p style="color: ${isOnline ? '#4CAF50' : '#888'}; font-size: 11px; font-weight: bold;">
                                        Status: ${isOnline ? 'Online Now' : 'Offline'}
                                    </p>
                                </div>
                                ${canModify ? `
                                    <div class="user-actions">
                                        <button class="action-btn ban-btn" onclick="banUser('${user.username}')">ğŸš« Ban</button>
                                        <button class="action-btn remove-btn" onclick="removeUser('${user.username}')">ğŸ—‘ï¸ Remove</button>
                                    </div>
                                ` : user.username === 'admin' ? '<div style="color: #ffd700; font-size: 11px; font-weight: bold;">Owner Admin</div>' : '<div style="color: #888; font-size: 11px;">Protected</div>'}
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                // Regular users only see other active users (no admin controls)
                const list = document.getElementById('accountsList');
                const otherUsers = onlineUsers.filter(user => user.username !== currentUser);
                
                list.innerHTML = otherUsers.map(user => {
                    const isOnline = user.last_seen && (Date.now() - new Date(user.last_seen).getTime()) < 60000;
                    return `
                        <div class="beat-item">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div style="flex: 1;">
                                    <h3 style="color: #ffd700; margin: 0;">
                                        ${user.username} ğŸ‘¤
                                        ${isOnline ? '<span style="color: #4CAF50;">ğŸŸ¢</span>' : '<span style="color: #888;">âš«</span>'}
                                    </h3>
                                    <p style="color: #ccc; margin: 5px 0; font-size: 12px;">Producer</p>
                                    <p style="color: ${isOnline ? '#4CAF50' : '#888'}; font-size: 11px; font-weight: bold;">
                                        ${isOnline ? 'Online Now' : 'Offline'}
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }
        
        function showInactiveUsers() {
            if (userLevel > 2) return;
            
            currentAccountFilter = 'inactive';
            updateFilterButtons();
            
            const inactiveUsers = userAccounts.filter(user => user.status === 'inactive');
            const list = document.getElementById('accountsList');
            
            if (inactiveUsers.length === 0) {
                list.innerHTML = `
                    <div class="beat-item">
                        <p style="text-align: center; color: #888; font-style: italic;">No inactive users found</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = inactiveUsers.map(user => `
                <div class="beat-item">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div style="flex: 1;">
                            <h3 style="color: #888; margin: 0;">${user.username} ğŸ‘¤</h3>
                            <p style="color: #666; margin: 5px 0; font-size: 12px;">Role: ${user.role}</p>
                            <p style="color: #555; font-size: 11px;">Created: ${user.created} â€¢ Last Login: ${user.lastLogin}</p>
                            <p style="color: #f44336; font-size: 11px; font-weight: bold;">Status: Inactive</p>
                        </div>
                        <div class="user-actions">
                            <button class="action-btn restore-btn" onclick="restoreUser(${user.id})">âœ… Restore</button>
                            <button class="action-btn remove-btn" onclick="removeUser(${user.id})">ğŸ—‘ï¸ Remove</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function updateFilterButtons() {
            document.querySelectorAll('.account-filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === currentAccountFilter) {
                    btn.classList.add('active');
                }
            });
        }

        function loadProposals() {
            const list = document.getElementById('proposalsList');
            
            // Sample feature proposals for users to view
            const sampleProposals = [
                {
                    id: 1,
                    title: 'Real-time Collaboration Mode',
                    description: 'Allow multiple producers to work on beats together in real-time',
                    author: 'Producer_Mike',
                    date: '2024-01-15',
                    status: 'Under Review',
                    votes: 23
                },
                {
                    id: 2,
                    title: 'Voice-to-Beat Generation',
                    description: 'Hum or beatbox into microphone to generate similar beats',
                    author: 'BeatMaker_X',
                    date: '2024-01-12',
                    status: 'In Development',
                    votes: 45
                },
                {
                    id: 3,
                    title: 'Advanced Swing Controls',
                    description: 'More precise timing controls for groove and swing adjustments',
                    author: 'RhythmMaster',
                    date: '2024-01-10',
                    status: 'Approved',
                    votes: 67
                }
            ];
            
            list.innerHTML = `
                <div style="margin-bottom: 20px; padding: 15px; background: rgba(255,215,0,0.1); border: 1px solid #ffd700; border-radius: 8px;">
                    <h3 style="color: #ffd700; margin-bottom: 10px;">ğŸ’¡ Feature Proposals</h3>
                    <p style="color: #ccc; margin-bottom: 10px;">Community-driven feature suggestions for AiBeatzbyJyntzu</p>
                    ${userLevel <= 2 ? '<p style="color: #4CAF50; font-size: 12px;">Admin: You can approve/reject proposals</p>' : '<p style="color: #888; font-size: 12px;">View community suggestions - Use Puter AI to submit your own ideas</p>'}
                </div>
                ${sampleProposals.map(proposal => `
                    <div class="beat-item" style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1;">
                                <h4 style="color: #ffd700; margin: 0; font-size: 16px;">${proposal.title}</h4>
                                <p style="color: #ccc; margin: 8px 0; font-size: 14px;">${proposal.description}</p>
                                <div style="display: flex; gap: 15px; font-size: 12px; color: #888; margin-top: 10px;">
                                    <span>ğŸ‘¤ ${proposal.author}</span>
                                    <span>ğŸ“… ${proposal.date}</span>
                                    <span>ğŸ‘ ${proposal.votes} votes</span>
                                </div>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
                                <span style="background: ${proposal.status === 'Approved' ? '#4CAF50' : proposal.status === 'In Development' ? '#2196F3' : '#FF9800'}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">
                                    ${proposal.status}
                                </span>
                                <div style="display: flex; gap: 5px; margin-top: 5px;">
                                    <button onclick="refineProposal(${proposal.id})" style="background: #2196F3; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer;">ğŸ”§ Refine</button>
                                    ${userLevel <= 2 ? `
                                        <button onclick="approveProposal(${proposal.id})" style="background: #4CAF50; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer;">âœ… Approve</button>
                                        <button onclick="rejectProposal(${proposal.id})" style="background: #f44336; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer;">âŒ Reject</button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('')}
            `;
        }
        
        function approveProposal(proposalId) {
            if (userLevel > 2) {
                showNotification('Admin access required', 'error');
                return;
            }
            showNotification(`Proposal ${proposalId} approved!`, 'success');
            loadProposals();
        }
        
        function rejectProposal(proposalId) {
            if (userLevel > 2) {
                showNotification('Admin access required', 'error');
                return;
            }
            showNotification(`Proposal ${proposalId} rejected`, 'warning');
            loadProposals();
        }
        
        function refineProposal(proposalId) {
            showTab('puter');
            document.getElementById('chatContext').value = 'general';
            
            const proposals = {
                1: 'Real-time Collaboration Mode - Allow multiple producers to work on beats together in real-time',
                2: 'Voice-to-Beat Generation - Hum or beatbox into microphone to generate similar beats', 
                3: 'Advanced Swing Controls - More precise timing controls for groove and swing adjustments'
            };
            
            const proposal = proposals[proposalId];
            if (proposal) {
                document.getElementById('chatInput').value = `Help me refine this feature proposal: "${proposal}". What are the technical requirements, user benefits, and potential challenges?`;
                addChatMessage('System', `ğŸ”§ Refining proposal ${proposalId}. Ask Puter AI for suggestions to improve this feature idea.`);
                showNotification('Switched to Puter AI for proposal refinement', 'success');
            }
        }

        // Account Management
        function createNewAccount() {
            if (userLevel > 2) {
                showNotification('Admin access required', 'error');
                return;
            }
            
            // Create account type selection modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10000;
                display: flex; justify-content: center; align-items: center;
            `;
            
            const dialog = document.createElement('div');
            dialog.style.cssText = `
                background: #1a1a1a; padding: 30px; border-radius: 15px;
                border: 2px solid #ffd700; min-width: 400px; text-align: center;
            `;
            
            dialog.innerHTML = `
                <h3 style="color: #ffd700; margin-bottom: 20px;">ğŸ‘¥ Create New Account</h3>
                <p style="color: #ccc; margin-bottom: 30px;">Select account type to create:</p>
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    ${userLevel === 1 ? '<button onclick="createAccount(\'employee_admin\', 2)" style="background: #FF9800; color: white; border: none; padding: 15px 20px; border-radius: 5px; cursor: pointer; font-size: 16px;">ğŸ›¡ï¸ Employee Admin</button>' : ''}
                    <button onclick="createAccount(\'user\', 3)" style="background: #4CAF50; color: white; border: none; padding: 15px 20px; border-radius: 5px; cursor: pointer; font-size: 16px;">ğŸ‘¤ Regular User</button>
                    <button onclick="cancelAccountCreation()" style="background: #666; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Cancel</button>
                </div>
            `;
            
            modal.appendChild(dialog);
            document.body.appendChild(modal);
            
            window.createAccount = function(role, level) {
                // Generate unique username
                const timestamp = Date.now();
                const username = `user_${timestamp}`;
                const password = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 8);
                
                const newUser = {
                    username: username,
                    password: password,
                    role: role,
                    level: level,
                    ip: 'Local',
                    location: 'Desktop App',
                    login_time: new Date().toISOString(),
                    last_seen: new Date().toISOString(),
                    created: new Date().toLocaleDateString()
                };
                
                onlineUsers.push(newUser);
                initializeUserAnalytics(username);
                
                const roleDisplay = level === 1 ? 'Owner Admin' : level === 2 ? 'Employee Admin' : 'User';
                
                // Only show notification, no alert popup
                showNotification(`Account created: ${username} (${roleDisplay})`, 'success');
                
                if (currentAccountFilter === 'active') {
                    showActiveUsers();
                }
                
                // Clean up
                document.body.removeChild(modal);
                delete window.createAccount;
                delete window.cancelAccountCreation;
            };
            
            window.cancelAccountCreation = function() {
                document.body.removeChild(modal);
                delete window.createAccount;
                delete window.cancelAccountCreation;
            };
        }
        
        function banUser(username) {
            if (userLevel !== 1) {
                showNotification('Owner Admin access required', 'error');
                return;
            }
            
            if (username !== 'admin') {
                if (confirm(`Ban user "${username}"?`)) {
                    onlineUsers = onlineUsers.filter(u => u.username !== username);
                    showNotification(`User ${username} has been banned`, 'warning');
                    showActiveUsers();
                }
            }
        }
        
        function restoreUser(userId) {
            if (userLevel !== 1) {
                showNotification('Owner Admin access required', 'error');
                return;
            }
            
            const user = userAccounts.find(u => u.id === userId);
            if (user) {
                if (confirm(`Restore user "${user.username}"?`)) {
                    user.status = 'active';
                    showNotification(`User ${user.username} has been restored`, 'success');
                    showInactiveUsers();
                }
            }
        }
        
        function removeUser(username) {
            if (userLevel !== 1) {
                showNotification('Owner Admin access required', 'error');
                return;
            }
            
            if (username !== 'admin') {
                if (confirm(`Permanently remove user "${username}"? This cannot be undone.`)) {
                    onlineUsers = onlineUsers.filter(u => u.username !== username);
                    showNotification(`User ${username} has been removed`, 'error');
                    showActiveUsers();
                }
            }
        }
        
        function togglePassword(username, password) {
            if (username !== currentUser && userLevel !== 1) {
                showNotification('Can only view your own password', 'error');
                return;
            }
            
            const passElement = document.getElementById(`pass-${username}`);
            const isHidden = passElement.textContent.includes('â€¢');
            
            if (isHidden) {
                passElement.textContent = password;
                passElement.style.color = '#4CAF50';
            } else {
                passElement.textContent = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
                passElement.style.color = '#888';
            }
        }
        
        function generateProfessionalBeat(payload) {
            showStatus('ğŸµ Generating professional beat...', 'info');
            updateProgress(50, 'Creating professional beat...');
            
            // Generate beat using built-in audio synthesis
            setTimeout(() => {
                const beatId = (Date.now() + Math.random()).toString();
                const beatName = payload.custom_name || `Offline_Beat_${Date.now()}`;
                const now = new Date();
                const dateStr = now.toLocaleString();
                
                const beat = {
                    id: beatId,
                    name: beatName,
                    audioUrl: '', // No file URL for synthetic beats
                    samples: 'Professional Studio Samples',
                    date: dateStr,
                    tempo: payload.tempo,
                    length: payload.bars,
                    metadata: {
                        settings: {
                            genre: payload.genre || 'Hip-Hop',
                            mood: payload.mood || 'Chill',
                            tempo: payload.tempo || 120,
                            length: payload.bars || 32,
                            complexity: payload.complexity || 'intermediate',
                            mode: payload.mode || 'inputs',
                            styleEra: payload.style?.includes('old_school') ? 'Old School' : 'Modern',
                            audioAnalysis: 'Professional Generation',
                            aiEnhanced: false,
                            drumKit: payload.drum_kit || 'default',
                            actualKit: payload.drum_kit || 'Professional'
                        },
                        eq: payload.eq || { low: 0, mid: 0, high: 0 },
                        keywords: payload.keyword || payload.description || 'Professional Generation',
                        concept: payload.concept || 'N/A',
                        samplesUsed: ['Studio Kick', 'Studio Snare', 'Studio Hi-hat', 'Studio Bass'],
                        aiTraining: 'Professional Mode'
                    }
                };
                
                generatedBeats.unshift(beat);
                
                // Add beat to UI
                const beatsContainer = document.getElementById('beats');
                const beatDiv = document.createElement('div');
                beatDiv.className = 'beat-item';
                
                beatDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <h3 style="color: #ffd700; margin: 0;">${beat.name}</h3>
                            <p style="color: #ccc; margin: 5px 0; font-size: 12px;">${beat.date}</p>
                            <p style="color: #888; font-size: 11px;">${beat.tempo} BPM â€¢ ${beat.length} bars â€¢ Samples: ${beat.samples}</p>
                        </div>
                        <button class="expand-btn" onclick="toggleMetadata('${beatId}')">Details â–¼</button>
                        <button onclick="playBeat('${beatId}')" style="padding: 8px 16px; background: #4caf50; color: white; border: none; border-radius: 20px; cursor: pointer; margin-right: 10px;">â–¶ï¸ Play</button>
                        <button onclick="downloadSyntheticBeat('${beatId}')" style="padding: 8px 16px; background: #2196F3; color: white; border: none; border-radius: 20px; cursor: pointer;">ğŸ“¥ Download</button>
                    </div>
                    
                    <div id="metadata-${beatId}" class="beat-metadata">
                        <div class="metadata-grid">
                            <div class="metadata-section">
                                <div class="metadata-title">ğŸµ Generation Settings</div>
                                <div class="metadata-item">Genre: ${beat.metadata.settings.genre}</div>
                                <div class="metadata-item">Mood: ${beat.metadata.settings.mood}</div>
                                <div class="metadata-item">Mode: ${beat.metadata.settings.mode}</div>
                                <div class="metadata-item">Style Era: ${beat.metadata.settings.styleEra}</div>
                                <div class="metadata-item">Complexity: ${beat.metadata.settings.complexity}</div>
                                <div class="metadata-item">Analysis: ${beat.metadata.settings.audioAnalysis}</div>
                            </div>
                            
                            <div class="metadata-section">
                                <div class="metadata-title">ğŸ¹ Audio Settings</div>
                                <div class="metadata-item">Tempo: ${beat.metadata.settings.tempo} BPM</div>
                                <div class="metadata-item">Length: ${beat.metadata.settings.length} bars</div>
                                <div class="metadata-item">EQ Low: ${beat.metadata.eq.low} dB</div>
                                <div class="metadata-item">EQ Mid: ${beat.metadata.eq.mid} dB</div>
                                <div class="metadata-item">EQ High: ${beat.metadata.eq.high} dB</div>
                            </div>
                        </div>
                        
                        <div class="metadata-section">
                            <div class="metadata-title">ğŸ§ Samples Used</div>
                            ${beat.metadata.samplesUsed.map(sample => `<div class="metadata-item">â€¢ ${sample}</div>`).join('')}
                        </div>
                        
                        <div class="metadata-section" style="margin-top: 10px;">
                            <div class="metadata-title">ğŸ“ Keywords & Description</div>
                            <div class="metadata-item">${beat.metadata.keywords}</div>
                            ${beat.metadata.concept !== 'N/A' ? `<div class="metadata-item">Concept: ${beat.metadata.concept}</div>` : ''}
                            <div class="metadata-item" style="color: #888; font-weight: bold;">
                                AI Mode: ${beat.metadata.aiTraining}
                            </div>
                        </div>
                    </div>
                `;
                
                beatsContainer.insertBefore(beatDiv, beatsContainer.firstChild);
                
                updateProgress(100, 'Complete!');
                hideProgressBar();
                showStatus('âœ… Professional beat generated successfully!', 'success');
                showNotification('ğŸµ Professional beat generated!');
                updateFileLibrary();
                
                if (currentUser) {
                    saveUserAnalytics();
                    updateGenerationHistory(
                        payload.genre,
                        payload.mood,
                        payload.complexity,
                        payload.tempo
                    );
                }
            }, 1000);
        }

        // Enhanced Theme Management with ALL 12 themes
        function changeTheme(theme) {
            currentTheme = theme;
            const colors = themes[theme];
            
            document.body.style.background = colors.bg;
            document.body.style.color = colors.text;
            
            // Remove existing theme classes
            document.body.className = document.body.className.replace(/\b\w+-theme\b/g, '');
            
            // Add new theme class
            document.body.classList.add(theme + '-theme');
            
            // Update all elements with theme colors
            document.querySelectorAll('.header').forEach(el => {
                el.style.background = colors.secondary;
                el.style.borderBottomColor = colors.primary;
            });
            
            document.querySelectorAll('.tab').forEach(el => {
                el.style.background = colors.secondary;
                el.style.color = colors.primary;
            });
            
            document.querySelectorAll('.tab.active').forEach(el => {
                el.style.background = colors.primary;
                el.style.color = colors.bg;
            });
            
            document.querySelectorAll('.section, .sampling-controls, .beat-item, .analytics-card').forEach(el => {
                el.style.background = colors.secondary;
                el.style.borderLeftColor = colors.primary;
            });
            
            document.querySelectorAll('label, h1, h2, h3').forEach(el => {
                el.style.color = colors.primary;
            });
            
            document.querySelectorAll('input, select, textarea').forEach(el => {
                el.style.background = colors.bg;
                el.style.color = colors.text;
                el.style.borderColor = colors.primary;
            });
            
            document.querySelectorAll('button').forEach(el => {
                if (!el.classList.contains('logout-btn')) {
                    el.style.background = colors.primary;
                    el.style.color = colors.bg;
                }
            });
            
            // Special effects for space theme
            if (theme === 'space') {
                if (!document.querySelector('.floating-orb')) {
                    const orb = document.createElement('div');
                    orb.className = 'floating-orb';
                    document.body.appendChild(orb);
                }
            } else {
                // Remove space effects for other themes
                const orb = document.querySelector('.floating-orb');
                if (orb) orb.remove();
            }
        }

        // Update file library stats
        function updateFileLibrary() {
            const totalBeats = generatedBeats.length;
            
            document.getElementById('totalBeatsCount').textContent = totalBeats;
            document.getElementById('sessionBeats').textContent = totalBeats;
            document.getElementById('successRate').textContent = totalBeats > 0 ? '100%' : '0%';
            
            if (totalBeats > 0) {
                document.getElementById('lastGenerated').textContent = generatedBeats[0].date;
            } else {
                document.getElementById('lastGenerated').textContent = 'None';
            }
            
            // Load actual sample library stats
            loadSampleLibrary();
        }
        
        // Load sample library stats
        async function loadSampleLibrary() {
            try {
                const response = await fetch('http://localhost:5050/sample_library_stats', {
                    method: 'GET',
                    signal: AbortSignal.timeout(3000)
                });
                const data = await response.json();
                if (data.status === 'success') {
                    const totalSamples = data.total_samples || 105000;
                    const totalSizeGB = ((totalSamples * 2.8) / 1024).toFixed(1);
                    document.getElementById('totalAudioCount').textContent = totalSamples.toLocaleString();
                    document.getElementById('storageUsed').textContent = `${totalSizeGB} GB (${totalSamples.toLocaleString()} samples)`;
                    return;
                }
            } catch (error) {
                console.log('Backend unavailable - using catalog estimates');
            }
            
            // Fallback to estimated stats
            const totalSamples = 105000; // Your actual catalog size
            const totalSizeGB = ((totalSamples * 2.8) / 1024).toFixed(1);
            document.getElementById('totalAudioCount').textContent = totalSamples.toLocaleString();
            document.getElementById('storageUsed').textContent = `${totalSizeGB} GB (${totalSamples.toLocaleString()} samples)`;
        }
        
        // Initialize app
        function initializeApp() {
            // Set default values
            document.getElementById('tempo').value = 120;
            document.getElementById('length').value = 32;
            document.getElementById('eqLow').value = 0;
            document.getElementById('eqMid').value = 0;
            document.getElementById('eqHigh').value = 0;
            
            // Update display values
            updateTempo();
            updateLength();
            document.getElementById('eqLowValue').textContent = 0;
            document.getElementById('eqMidValue').textContent = 0;
            document.getElementById('eqHighValue').textContent = 0;
            
            // Audio event listeners
            const audio = document.getElementById('beatAudio');
            audio.addEventListener('timeupdate', updateProgress);
            audio.addEventListener('loadedmetadata', () => {
                const totalMin = Math.floor(audio.duration / 60);
                const totalSec = Math.floor(audio.duration % 60);
                document.getElementById('timeDisplay').textContent = `0:00 / ${totalMin}:${totalSec.toString().padStart(2, '0')}`;
            });
            audio.addEventListener('ended', () => {
                document.getElementById('playBtn').textContent = 'â–¶ï¸';
                document.getElementById('compactProgressBar').style.width = '0%';
                isPlaying = false;
            });
            audio.addEventListener('pause', () => {
                document.getElementById('playBtn').textContent = 'â–¶ï¸';
                isPlaying = false;
            });
            audio.addEventListener('play', () => {
                document.getElementById('playBtn').textContent = 'â¸ï¸';
                isPlaying = true;
            });
            
            // Initialize file library
            updateFileLibrary();
            loadSampleLibrary();
            
            // Initialize AI learning display
            updateAILearningDisplay();
            updateAIStatus(0);
            updateAIToggleColor();
            updateMiniAnalytics('AI system ready');
            
            // Initialize notifications if owner admin
            if (userLevel === 1) {
                updateNotificationHistory();
                updateNotificationStats();
            }
            
            // Load existing training data stats
            loadTrainingStats();
        }
        
        function loadTrainingStats() {
            updateAILearningDisplay();
        }
        
        function updateAILearningDisplay() {
            const totalTracksEl = document.getElementById('totalTracksAnalyzed');
            const patternsEl = document.getElementById('patternsLearned');
            const accuracyEl = document.getElementById('beatAccuracy');
            const speedEl = document.getElementById('learningSpeed');
            
            if (totalTracksEl) totalTracksEl.textContent = aiLearningStats.totalTracks;
            if (patternsEl) patternsEl.textContent = aiLearningStats.genresLearned.size * 10;
            if (accuracyEl) accuracyEl.textContent = Math.floor(aiLearningStats.accuracy) + '%';
            if (speedEl) speedEl.textContent = aiLearningStats.learningSpeed;
            
            const tracksProgress = Math.min((aiLearningStats.totalTracks / 1000) * 100, 100);
            const patternsProgress = Math.min((aiLearningStats.genresLearned.size / 20) * 100, 100);
            const accuracyProgress = aiLearningStats.accuracy;
            const speedProgress = Math.min((aiLearningStats.learningSpeed / 100) * 100, 100);
            
            const tracksProgressEl = document.getElementById('tracksProgress');
            const patternsProgressEl = document.getElementById('patternsProgress');
            const accuracyProgressEl = document.getElementById('accuracyProgress');
            const speedProgressEl = document.getElementById('speedProgress');
            
            if (tracksProgressEl) tracksProgressEl.style.width = tracksProgress + '%';
            if (patternsProgressEl) patternsProgressEl.style.width = patternsProgress + '%';
            if (accuracyProgressEl) accuracyProgressEl.style.width = accuracyProgress + '%';
            if (speedProgressEl) speedProgressEl.style.width = speedProgress + '%';
        }
        
        function checkMilestones() {
            const milestones = [
                { tracks: 10, title: 'ğŸ¯ First Training' },
                { tracks: 50, title: 'ğŸ“ˆ Learning Progress' },
                { tracks: 100, title: 'ğŸš€ AI Enhanced' },
                { tracks: 500, title: 'ğŸ§  Expert Level' }
            ];
            
            milestones.forEach(milestone => {
                if (aiLearningStats.totalTracks >= milestone.tracks && 
                    !aiLearningStats.milestones.includes(milestone.title)) {
                    aiLearningStats.milestones.push(milestone.title);
                    showNotification(`Milestone: ${milestone.title}`, 'success');
                }
            });
        }
        
        function addToLearningFeed(message) {
            const feedEl = document.getElementById('learningFeed');
            if (feedEl) {
                const timestamp = new Date().toLocaleTimeString();
                feedEl.innerHTML = `[${timestamp}] ${message}\n` + feedEl.innerHTML;
                
                const lines = feedEl.innerHTML.split('\n');
                if (lines.length > 50) {
                    feedEl.innerHTML = lines.slice(0, 50).join('\n');
                }
            }
        }
        
        function updateGenreBreakdown(genreStats) {
            const breakdown = document.getElementById('genreBreakdown');
            if (!genreStats || !breakdown) return;
            
            breakdown.innerHTML = Object.entries(genreStats).map(([genre, stats]) => `
                <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 5px;">
                    <div style="color: #ffd700; font-weight: bold;">${genre}</div>
                    <div style="font-size: 12px; color: #ccc;">Tracks: ${stats.count || 0}</div>
                </div>
            `).join('');
        }
        
        async function exportLearningModel() {
            try {
                const modelData = {
                    user: currentUser,
                    stats: aiLearningStats,
                    timestamp: Date.now(),
                    version: '1.0.0'
                };
                
                const blob = new Blob([JSON.stringify(modelData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `aibeatz_model_${Date.now()}.json`;
                link.click();
                URL.revokeObjectURL(url);
                
                showNotification('AI learning model exported successfully!');
            } catch (error) {
                showNotification('Export failed', 'error');
            }
        }
        
        async function viewTrainingData() {
            const genre = document.getElementById('trainingGenre').value;
            
            const mockData = [
                { tempo: 140.5, energy: 0.8, rhythm_pattern: ['kick', 'hihat', 'snare'] },
                { tempo: 128.0, energy: 0.6, rhythm_pattern: ['kick', 'snare', 'hihat'] },
                { tempo: 160.2, energy: 0.9, rhythm_pattern: ['kick', 'kick', 'snare'] }
            ];
            
            displayTrainingDataModal(mockData, genre);
        }
        
        function displayTrainingDataModal(trainingData, genre) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10000;
                display: flex; justify-content: center; align-items: center;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: #1a1a1a; padding: 30px; border-radius: 15px;
                max-width: 80%; max-height: 80%; overflow-y: auto;
                border: 2px solid #ffd700;
            `;
            
            content.innerHTML = `
                <h3 style="color: #ffd700; margin-bottom: 20px;">ğŸ“Š ${genre} Training Data</h3>
                <div style="color: #ccc; margin-bottom: 15px;">Total Samples: ${trainingData.length}</div>
                <div style="font-family: monospace; font-size: 12px; color: #888;">
                    ${trainingData.slice(0, 10).map((data, i) => `
                        <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">
                            <strong>Sample ${i+1}:</strong> Tempo: ${data.tempo?.toFixed(1)} BPM, 
                            Energy: ${data.energy?.toFixed(2)}, 
                            Patterns: ${data.rhythm_pattern?.length || 0} elements
                        </div>
                    `).join('')}
                    ${trainingData.length > 10 ? `<div style="text-align: center; color: #888;">... and ${trainingData.length - 10} more samples</div>` : ''}
                </div>
                <button onclick="this.parentElement.parentElement.remove()" 
                        style="background: #ffd700; color: #000; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 15px;">
                    Close
                </button>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Apply default theme
            changeTheme('dark-gold');
            
            // Show first tab
            showTab('studio');
        }
        
        function updateAIStatus(tracksAnalyzed) {
            const statusText = document.getElementById('aiStatusText');
            const modeSelect = document.getElementById('aiLearningMode');
            const mode = modeSelect.value;
            
            if (mode === 'off' || !aiLearningEnabled) {
                statusText.textContent = 'AI Learning Disabled - Standard beat generation only';
                statusText.style.color = '#888';
            } else if (mode === 'passive') {
                statusText.textContent = `AI Passive Mode - Learning from beat generation (${aiLearningStats.totalTracks} tracks analyzed)`;
                statusText.style.color = '#FF9800';
            } else if (mode === 'active') {
                statusText.textContent = `AI Active Mode - Enhanced generation with ${aiLearningStats.totalTracks} tracks analyzed`;
                statusText.style.color = '#4CAF50';
            }
            
            // Update button color
            updateAIToggleColor();
        }
        
        function toggleAILearning() {
            aiLearningEnabled = !aiLearningEnabled;
            updateAIStatus(0);
            
            // Update AI learning mode selector
            const modeSelect = document.getElementById('aiLearningMode');
            if (!aiLearningEnabled) {
                modeSelect.value = 'off';
                modeSelect.disabled = true;
            } else {
                modeSelect.disabled = false;
                modeSelect.value = 'passive';
            }
            
            // Update button color based on mode
            updateAIToggleColor();
            
            showNotification(aiLearningEnabled ? 'AI Learning Enabled' : 'AI Learning Disabled');
        }
        
        function updateAIToggleColor() {
            const modeSelect = document.getElementById('aiLearningMode');
            const toggle = document.getElementById('aiToggle');
            const mode = modeSelect.value;
            
            if (mode === 'off') {
                toggle.style.background = '#f44336'; // Red
                toggle.textContent = 'AI OFF';
            } else if (mode === 'passive') {
                toggle.style.background = '#FF9800'; // Orange
                toggle.textContent = 'AI ON';
            } else if (mode === 'active') {
                toggle.style.background = '#4CAF50'; // Green
                toggle.textContent = 'AI ON';
            }
        }
        
        async function startAITraining() {
            const mode = document.getElementById('trainingMode').value;
            const genre = document.getElementById('trainingGenre').value;
            const mood = document.getElementById('trainingMood').value;
            const depth = parseInt(document.getElementById('analysisDepth').value);
            const statusDiv = document.getElementById('trainingStatus');
            
            statusDiv.innerHTML = `ğŸš€ Starting ${mode} training for ${genre} ${mood} (${depth} tracks)...`;
            statusDiv.style.color = '#ffd700';
            updateMiniAnalytics(`Starting ${genre} ${mood} training...`);
            
            try {
                const response = await fetch('http://localhost:5050/start_ai_training', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        mode: mode,
                        genre: genre,
                        mood: mood,
                        depth: depth,
                        user_id: currentUser
                    })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    statusDiv.innerHTML = `âœ… Training completed! Analyzed ${data.tracks_analyzed} tracks`;
                    statusDiv.style.color = '#4CAF50';
                    
                    updateAILearningStats(data.tracks_analyzed, genre, mood);
                    updateGenreBreakdown(data.genre_stats);
                    updateAIStatus(data.tracks_analyzed);
                    updateMiniAnalytics(`Trained on ${data.tracks_analyzed} ${genre} tracks`);
                    
                    // Auto-learn from this training if AI is enabled
                    if (aiLearningEnabled && document.getElementById('aiLearningMode').value === 'active') {
                        addToLearningFeed(`Auto-learning: Training data integrated into beat generation AI`);
                        updateMiniAnalytics(`AI enhanced with ${genre} patterns`);
                    }
                    
                    showNotification(`AI trained on ${data.tracks_analyzed} ${genre} ${mood} tracks!`);
                } else {
                    statusDiv.innerHTML = `âŒ Training failed: ${data.error}`;
                    statusDiv.style.color = '#f44336';
                    updateMiniAnalytics('Training failed - check connection');
                }
            } catch (error) {
                statusDiv.innerHTML = `âŒ Connection error: ${error.message}`;
                statusDiv.style.color = '#f44336';
                updateMiniAnalytics('Connection error - offline mode');
            }
        }
        
        function updateMiniAnalytics(feedMessage) {
            document.getElementById('miniTotalTracks').textContent = aiLearningStats.totalTracks;
            document.getElementById('miniAccuracy').textContent = Math.floor(aiLearningStats.accuracy) + '%';
            document.getElementById('miniSpeed').textContent = aiLearningStats.learningSpeed;
            if (feedMessage) {
                document.getElementById('miniLearningFeed').textContent = feedMessage;
            }
        }
        
        function loadNotifications() {
            if (userLevel === 1) {
                updateNotificationHistory();
                updateNotificationStats();
            }
        }

        function addLibraryCatalog() {
            // Use a simple input dialog instead of prompt()
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10000;
                display: flex; justify-content: center; align-items: center;
            `;
            
            const dialog = document.createElement('div');
            dialog.style.cssText = `
                background: #1a1a1a; padding: 30px; border-radius: 15px;
                border: 2px solid #ffd700; min-width: 400px;
            `;
            
            dialog.innerHTML = `
                <h3 style="color: #ffd700; margin-bottom: 20px;">ğŸ“ Add Sample Catalog</h3>
                <input type="text" id="catalogPath" placeholder="C:\\Music\\Samples" 
                       style="width: 100%; padding: 10px; margin-bottom: 20px; background: #2d2d2d; color: #fff; border: 1px solid #555; border-radius: 5px;">
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="cancelAddCatalog()" style="background: #666; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Cancel</button>
                    <button onclick="confirmAddCatalog()" style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Add Catalog</button>
                </div>
            `;
            
            modal.appendChild(dialog);
            document.body.appendChild(modal);
            
            // Focus input
            setTimeout(() => document.getElementById('catalogPath').focus(), 100);
            
            // Handle Enter key
            document.getElementById('catalogPath').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') confirmAddCatalog();
            });
            
            window.confirmAddCatalog = function() {
                const path = document.getElementById('catalogPath').value.trim();
                if (path) {
                    const catalogList = document.getElementById('libraryCatalogList');
                    const newCatalog = document.createElement('div');
                    newCatalog.className = 'catalog-item';
                    const folderName = path.split('\\').pop() || path.split('/').pop() || 'Custom Catalog';
                    newCatalog.innerHTML = `
                        <div>
                            <strong>${folderName}</strong><br>
                            <small style="color: #888;">${path}</small>
                        </div>
                        <span style="color: #4CAF50;">Active</span>
                    `;
                    catalogList.appendChild(newCatalog);
                    showNotification('âœ… Sample catalog added to library!');
                } else {
                    showNotification('Please enter a valid path', 'warning');
                }
                document.body.removeChild(modal);
                delete window.confirmAddCatalog;
                delete window.cancelAddCatalog;
            };
            
            window.cancelAddCatalog = function() {
                document.body.removeChild(modal);
                delete window.confirmAddCatalog;
                delete window.cancelAddCatalog;
            };
        }
        
        // Window controls
        function minimizeWindow() {
            try {
                if (typeof require !== 'undefined') {
                    const { ipcRenderer } = require('electron');
                    ipcRenderer.invoke('minimize-window');
                } else {
                    window.minimize();
                }
            } catch (e) {
                console.log('Minimize not available in browser mode');
            }
        }
        
        function closeWindow() {
            if (confirm('Close AiBeatzbyJyntzu?')) {
                try {
                    if (typeof require !== 'undefined') {
                        const { ipcRenderer } = require('electron');
                        ipcRenderer.invoke('close-window');
                    } else {
                        window.close();
                    }
                } catch (e) {
                    window.close();
                }
            }
        }
        
        // Toggle metadata dropdown
        function toggleMetadata(beatId) {
            const metadata = document.getElementById(`metadata-${beatId}`);
            const isVisible = metadata.style.display === 'block';
            
            // Hide all other metadata sections
            document.querySelectorAll('.beat-metadata').forEach(el => {
                el.style.display = 'none';
            });
            
            // Toggle current metadata
            metadata.style.display = isVisible ? 'none' : 'block';
            
            // Update all expand buttons
            document.querySelectorAll('.expand-btn').forEach(btn => {
                btn.textContent = 'Details â–¼';
            });
            
            // Update current button
            if (!isVisible) {
                event.target.textContent = 'Details â–²';
            }
        }
        
        // Download synthetic beat
        function downloadSyntheticBeat(beatId) {
            const beat = generatedBeats.find(b => b.id === beatId);
            if (beat) {
                // Generate audio buffer for the beat
                const audioBuffer = generateBeatAudio(beat);
                
                // Convert to WAV and download
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const wavBuffer = audioBufferToWav(audioBuffer);
                const blob = new Blob([wavBuffer], { type: 'audio/wav' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `${beat.name}.wav`;
                link.click();
                
                URL.revokeObjectURL(url);
                showNotification(`ğŸ’¾ ${beat.name}.wav downloaded!`, 'success');
            }
        }
        
        // Convert AudioBuffer to WAV format
        function audioBufferToWav(buffer) {
            const length = buffer.length;
            const numberOfChannels = buffer.numberOfChannels;
            const sampleRate = buffer.sampleRate;
            const arrayBuffer = new ArrayBuffer(44 + length * numberOfChannels * 2);
            const view = new DataView(arrayBuffer);
            
            // WAV header
            const writeString = (offset, string) => {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            };
            
            writeString(0, 'RIFF');
            view.setUint32(4, 36 + length * numberOfChannels * 2, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, numberOfChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * numberOfChannels * 2, true);
            view.setUint16(32, numberOfChannels * 2, true);
            view.setUint16(34, 16, true);
            writeString(36, 'data');
            view.setUint32(40, length * numberOfChannels * 2, true);
            
            // Convert float samples to 16-bit PCM
            let offset = 44;
            for (let i = 0; i < length; i++) {
                for (let channel = 0; channel < numberOfChannels; channel++) {
                    const sample = Math.max(-1, Math.min(1, buffer.getChannelData(channel)[i]));
                    view.setInt16(offset, sample * 0x7FFF, true);
                    offset += 2;
                }
            }
            
            return arrayBuffer;
        }
        
        // Generate beat name
        function generateBeatName() {
            const adjectives = ['Dark', 'Heavy', 'Smooth', 'Hard', 'Chill', 'Fire', 'Cold', 'Deep', 'Raw', 'Clean'];
            const nouns = ['Beat', 'Track', 'Banger', 'Vibe', 'Flow', 'Rhythm', 'Sound', 'Groove', 'Hit', 'Jam'];
            const adj = adjectives[Math.floor(Math.random() * adjectives.length)];
            const noun = nouns[Math.floor(Math.random() * nouns.length)];
            const num = Math.floor(Math.random() * 999) + 1;
            return `${adj}_${noun}_${num}`;
        }
        
        // Progress bar functions
        function showProgressBar() {
            document.getElementById('progressOverlay').style.display = 'block';
            document.getElementById('progressBar').style.width = '0%';
        }
        
        function hideProgressBar() {
            document.getElementById('progressOverlay').style.display = 'none';
        }
        
        function updateProgress(percent, text) {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressText').textContent = text;
        }
        
        // Update AI learning stats
        function updateAILearningStats(tracksAnalyzed, genre, mood) {
            aiLearningStats.totalTracks += tracksAnalyzed;
            aiLearningStats.genresLearned.add(genre);
            aiLearningStats.accuracy = Math.min(95, aiLearningStats.accuracy + (tracksAnalyzed * 0.5));
            aiLearningStats.learningSpeed = Math.min(100, aiLearningStats.learningSpeed + (tracksAnalyzed * 0.2));
            
            checkMilestones();
            updateAILearningDisplay();
            saveUserAnalytics();
        }
        
        // Generate unique sample names based on generation settings
        function generateUniqueSampleNames(payload) {
            const genre = payload.genre || 'Hip-Hop';
            const mood = payload.mood || 'Chill';
            const timestamp = Date.now();
            const randomId = Math.random().toString(36).substring(2, 8);
            
            // Generate unique sample names based on actual generation parameters
            const sampleTypes = ['kick', 'snare', 'hihat', '808', 'melody', 'perc', 'vocal', 'pad'];
            const uniqueSamples = [];
            
            // Select 4-8 random sample types
            const numSamples = Math.floor(Math.random() * 5) + 4;
            const selectedTypes = sampleTypes.sort(() => 0.5 - Math.random()).slice(0, numSamples);
            
            selectedTypes.forEach((type, index) => {
                const sampleName = `${genre}_${mood}_${type}_${randomId}_${index + 1}.wav`;
                uniqueSamples.push(sampleName);
            });
            
            return uniqueSamples;
        }
        
        // Generate beat name based on keywords
        function generateBeatName() {
            const keywords = document.getElementById('samplingKeyword').value || document.getElementById('description').value;
            let baseName;
            
            if (keywords && keywords.trim()) {
                // Use first 2-3 words from keywords
                const keywordWords = keywords.trim().split(/\s+/).slice(0, 3);
                baseName = keywordWords.map(word => 
                    word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
                ).join(' ');
            } else {
                // Fallback to genre + mood
                const genre = document.getElementById('genre').value;
                const mood = document.getElementById('mood').value;
                baseName = `${genre} ${mood}`;
            }
            
            // Always add timestamp and random ID for uniqueness
            const timestamp = Date.now();
            const randomId = Math.random().toString(36).substring(2, 6).toUpperCase();
            const finalName = `${baseName} ${randomId}`;
            
            generatedBeatNames.add(finalName);
            return finalName;
        }
        
        // Progress bar functions
        function showProgressBar() {
            const overlay = document.getElementById('progressOverlay');
            overlay.style.display = 'flex';
            overlay.style.pointerEvents = 'none';
            updateProgress(0, 'Starting generation...');
        }
        
        function hideProgressBar() {
            document.getElementById('progressOverlay').style.display = 'none';
        }
        
        function updateProgress(percent, text) {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressText').textContent = text;
        }
        
        // Enhanced Test YouTube Scanner
        async function testScanner() {
            const statusDiv = document.getElementById('scanStatus');
            statusDiv.innerHTML = 'ğŸ§ª Testing YouTube music scanner...';
            statusDiv.style.color = '#ffd700';
            
            try {
                const response = await fetch('http://localhost:5050/test_music_scanner');
                const data = await response.json();
                
                if (data.status === 'success') {
                    statusDiv.innerHTML = `âœ… Music scanner operational! Database: ${data.tracks_in_db} tracks, Scanner: Ready`;
                    statusDiv.style.color = '#4CAF50';
                    
                    addToLearningFeed(`Scanner test: Found ${data.tracks_in_db} tracks in training database`);
                    if (data.sample_analysis) {
                        addToLearningFeed(`Sample features: Tempo ${data.sample_analysis.tempo}, Energy ${data.sample_analysis.energy}`);
                    }
                } else {
                    statusDiv.innerHTML = `âŒ Scanner error: ${data.error}`;
                    statusDiv.style.color = '#f44336';
                }
            } catch (error) {
                statusDiv.innerHTML = `âŒ Connection error: ${error.message}`;
                statusDiv.style.color = '#f44336';
            }
        }
        
        // YouTube Music Scanner
        async function scanYouTubeMusic() {
            const genre = document.getElementById('scanGenre').value;
            const mood = document.getElementById('scanMood').value;
            const maxSongs = parseInt(document.getElementById('maxSongs').value);
            const statusDiv = document.getElementById('scanStatus');
            
            statusDiv.innerHTML = `ğŸ” Scanning ${genre} ${mood} music on YouTube...`;
            statusDiv.style.color = '#ffd700';
            
            try {
                const response = await fetch('http://localhost:5050/scan_youtube_music', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ genre: genre, mood: mood, max_songs: maxSongs })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    statusDiv.innerHTML = `âœ… Scanned ${data.analyzed_tracks} ${genre} ${mood} tracks for AI training`;
                    statusDiv.style.color = '#4CAF50';
                    showNotification(`AI trained on ${data.analyzed_tracks} ${genre} ${mood} tracks!`);
                    
                    // Update AI learning stats
                    updateAILearningStats(data.analyzed_tracks, genre, mood);
                } else {
                    statusDiv.innerHTML = `âŒ Error: ${data.error}`;
                    statusDiv.style.color = '#f44336';
                }
            } catch (error) {
                statusDiv.innerHTML = `âŒ Connection error: ${error.message}`;
                statusDiv.style.color = '#f44336';
            }
        }
        
        // Enhanced AI Learning Stats Functions
        function updateAILearningStats(tracksAnalyzed, genre, mood) {
            aiLearningStats.totalTracks += tracksAnalyzed;
            aiLearningStats.genresLearned.add(genre);
            aiLearningStats.genresLearned.add(`${genre}_${mood}`);
            
            // Calculate accuracy (improves with more data)
            aiLearningStats.accuracy = Math.min(95, 60 + (aiLearningStats.totalTracks / 20));
            
            // Calculate learning speed
            aiLearningStats.learningSpeed = Math.floor(tracksAnalyzed * 60 / 2); // tracks per minute
            
            // Check for milestones
            checkMilestones();
            
            // Update display
            updateAILearningDisplay();
            updateMiniAnalytics(`Learned ${tracksAnalyzed} ${genre} patterns`);
            
            // Add to learning feed
            addToLearningFeed(`Analyzed ${tracksAnalyzed} ${genre} tracks - Patterns extracted`);
            
            // Save analytics
            if (currentUser) saveUserAnalytics();
        }
        
        // AI Training Functions
        async function startAITraining() {
            const mode = document.getElementById('trainingMode').value;
            const genre = document.getElementById('trainingGenre').value;
            const mood = document.getElementById('trainingMood').value;
            const depth = parseInt(document.getElementById('analysisDepth').value);
            const statusDiv = document.getElementById('trainingStatus');
            
            statusDiv.innerHTML = `ğŸš€ Simulating ${mode} training on YouTube & SoundCloud for ${genre} ${mood} (${depth} tracks)...`;
            statusDiv.style.color = '#ffd700';
            updateMiniAnalytics(`Starting ${genre} ${mood} training on YouTube & SoundCloud...`);
            
            // Simulate training with timeout
            setTimeout(() => {
                const simulatedTracks = Math.floor(Math.random() * depth) + 10;
                statusDiv.innerHTML = `âœ… Training completed! Analyzed ${simulatedTracks} tracks`;
                statusDiv.style.color = '#4CAF50';
                
                updateAILearningStats(simulatedTracks, genre, mood);
                updateAIStatus(simulatedTracks);
                updateMiniAnalytics(`Trained on ${simulatedTracks} ${genre} tracks`);
                
                if (aiLearningEnabled && document.getElementById('aiLearningMode').value === 'active') {
                    addToLearningFeed(`Auto-learning: Training data integrated into beat generation AI`);
                    updateMiniAnalytics(`AI enhanced with ${genre} patterns`);
                }
                
                showNotification(`AI trained on ${simulatedTracks} ${genre} ${mood} tracks!`);
            }, 2000);
        }
        
        async function viewTrainingData() {
            const genre = document.getElementById('trainingGenre').value;
            
            try {
                const response = await fetch(`http://localhost:5050/get_training_data/${genre}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayTrainingDataModal(data.training_data, genre);
                } else {
                    showNotification('No training data available for this genre', 'warning');
                }
            } catch (error) {
                showNotification('Failed to load training data', 'error');
            }
        }
        
        async function exportLearningModel() {
            try {
                const response = await fetch('http://localhost:5050/export_learning_model', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: currentUser })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    // Create download link
                    const link = document.createElement('a');
                    link.href = data.download_url;
                    link.download = `aibeatz_model_${Date.now()}.json`;
                    link.click();
                    
                    showNotification('AI learning model exported successfully!');
                } else {
                    showNotification('Failed to export model', 'error');
                }
            } catch (error) {
                showNotification('Export failed', 'error');
            }
        }
        
        function displayTrainingDataModal(trainingData, genre) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10000;
                display: flex; justify-content: center; align-items: center;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: #1a1a1a; padding: 30px; border-radius: 15px;
                max-width: 80%; max-height: 80%; overflow-y: auto;
                border: 2px solid #ffd700;
            `;
            
            content.innerHTML = `
                <h3 style="color: #ffd700; margin-bottom: 20px;">ğŸ“Š ${genre} Training Data</h3>
                <div style="color: #ccc; margin-bottom: 15px;">Total Samples: ${trainingData.length}</div>
                <div style="font-family: monospace; font-size: 12px; color: #888;">
                    ${trainingData.slice(0, 10).map((data, i) => `
                        <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">
                            <strong>Sample ${i+1}:</strong> Tempo: ${data.tempo?.toFixed(1)} BPM, 
                            Energy: ${data.energy?.toFixed(2)}, 
                            Patterns: ${data.rhythm_pattern?.length || 0} elements
                        </div>
                    `).join('')}
                    ${trainingData.length > 10 ? `<div style="text-align: center; color: #888;">... and ${trainingData.length - 10} more samples</div>` : ''}
                </div>
                <button onclick="this.parentElement.parentElement.remove()" 
                        style="background: #ffd700; color: #000; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 15px;">
                    Close
                </button>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
        }
        
        function updateGenreBreakdown(genreStats) {
            const breakdown = document.getElementById('genreBreakdown');
            if (!genreStats) return;
            
            breakdown.innerHTML = Object.entries(genreStats).map(([genre, stats]) => `
                <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 5px; text-align: center;">
                    <div style="color: #ffd700; font-weight: bold; font-size: 12px;">${genre}</div>
                    <div style="color: #4CAF50; font-size: 18px; margin: 5px 0;">${stats.count || 0}</div>
                    <div style="color: #888; font-size: 10px;">tracks analyzed</div>
                </div>
            `).join('');
        }
        
        function addToLearningFeed(message) {
            const feed = document.getElementById('learningFeed');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.style.cssText = 'margin: 2px 0; color: #4CAF50;';
            entry.textContent = `[${timestamp}] ${message}`;
            
            feed.insertBefore(entry, feed.firstChild);
            
            // Keep only last 20 entries
            while (feed.children.length > 20) {
                feed.removeChild(feed.lastChild);
            }
        }
        
        function checkMilestones() {
            const milestones = [
                { threshold: 10, title: 'First Analysis', icon: 'ğŸ‘¶', achieved: false },
                { threshold: 50, title: 'Pattern Recognition', icon: 'ğŸ“š', achieved: false },
                { threshold: 100, title: 'Music Intelligence', icon: 'ğŸ§ ', achieved: false },
                { threshold: 250, title: 'Genre Expert', icon: 'ğŸµ', achieved: false },
                { threshold: 500, title: 'AI Music Master', icon: 'ğŸ¤–', achieved: false },
                { threshold: 1000, title: 'Production Genius', icon: 'ğŸ†', achieved: false }
            ];
            
            milestones.forEach(milestone => {
                if (aiLearningStats.totalTracks >= milestone.threshold && !milestone.achieved) {
                    milestone.achieved = true;
                    aiLearningStats.milestones.push(milestone);
                    showNotification(`ğŸ† AI Milestone: ${milestone.title}!`, 'success');
                    addToLearningFeed(`ğŸ† Milestone achieved: ${milestone.title} (${milestone.threshold} tracks)`);
                }
            });
        }
        
        function updateAILearningDisplay() {
            // Update counters
            document.getElementById('totalTracksAnalyzed').textContent = aiLearningStats.totalTracks;
            document.getElementById('patternsLearned').textContent = aiLearningStats.genresLearned.size * 15; // Estimate patterns per genre
            document.getElementById('beatAccuracy').textContent = Math.floor(aiLearningStats.accuracy) + '%';
            document.getElementById('learningSpeed').textContent = aiLearningStats.learningSpeed;
            
            // Update progress bars
            const tracksProgress = Math.min(100, (aiLearningStats.totalTracks / 1000) * 100);
            const patternsProgress = Math.min(100, (aiLearningStats.genresLearned.size / 25) * 100);
            const accuracyProgress = (aiLearningStats.accuracy / 95) * 100;
            const speedProgress = Math.min(100, (aiLearningStats.learningSpeed / 300) * 100);
            
            document.getElementById('tracksProgress').style.width = tracksProgress + '%';
            document.getElementById('patternsProgress').style.width = patternsProgress + '%';
            document.getElementById('accuracyProgress').style.width = accuracyProgress + '%';
            document.getElementById('speedProgress').style.width = speedProgress + '%';
            
            // Update milestones
            const milestonesDiv = document.getElementById('milestones');
            milestonesDiv.innerHTML = aiLearningStats.milestones.map(m => 
                `<div style="background: #4CAF50; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">
                    ${m.icon} ${m.title}
                </div>`
            ).join('');
            
            // Initialize learning feed if empty
            const feed = document.getElementById('learningFeed');
            if (feed && feed.children.length === 0) {
                addToLearningFeed('AI Learning System initialized');
                addToLearningFeed('YouTube & SoundCloud Music Scanner ready');
                addToLearningFeed('Ready to analyze music patterns');
            }
        }
        
        // Sound functions
        function playSuccessSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Success chord (C major)
            const frequencies = [261.63, 329.63, 392.00]; // C, E, G
            
            frequencies.forEach((freq, i) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.1);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
                
                oscillator.start(audioContext.currentTime + i * 0.1);
                oscillator.stop(audioContext.currentTime + 0.8 + i * 0.1);
            });
        }
        
        function playErrorSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Error sound (descending notes)
            const frequencies = [400, 300, 200];
            
            frequencies.forEach((freq, i) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                oscillator.type = 'square';
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.05, audioContext.currentTime + 0.05);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime + i * 0.15);
                oscillator.stop(audioContext.currentTime + 0.3 + i * 0.15);
            });
        }
        
        // Load training statistics from backend
        async function loadTrainingStats() {
            // Skip backend call - use local stats only
            addToLearningFeed('AI Learning System initialized');
            updateMiniAnalytics('AI system ready for training');
        }
        
        // Enhanced YouTube Scanner Integration
        async function scanYouTubeMusic() {
            const genre = document.getElementById('scanGenre').value;
            const mood = document.getElementById('scanMood').value;
            const maxSongs = parseInt(document.getElementById('maxSongs').value);
            const statusDiv = document.getElementById('scanStatus');
            
            statusDiv.innerHTML = `ğŸ” Scanning ${genre} ${mood} music on YouTube...`;
            statusDiv.style.color = '#ffd700';
            
            try {
                const response = await fetch('http://localhost:5050/scan_youtube_music', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        genre: genre, 
                        mood: mood, 
                        max_songs: maxSongs,
                        analysis_mode: 'comprehensive'
                    })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    statusDiv.innerHTML = `âœ… Analyzed ${data.analyzed_tracks} ${genre} ${mood} tracks`;
                    statusDiv.style.color = '#4CAF50';
                    
                    // Update AI learning stats
                    updateAILearningStats(data.analyzed_tracks, genre, mood);
                    
                    // Show detailed results
                    if (data.patterns_extracted) {
                        addToLearningFeed(`Extracted ${data.patterns_extracted.rhythm_patterns} rhythm patterns`);
                        addToLearningFeed(`Identified ${data.patterns_extracted.harmonic_patterns} harmonic patterns`);
                        addToLearningFeed(`Analyzed ${data.patterns_extracted.spectral_features} spectral features`);
                    }
                    
                    showNotification(`AI learned from ${data.analyzed_tracks} ${genre} ${mood} tracks!`);
                } else {
                    statusDiv.innerHTML = `âŒ Error: ${data.error}`;
                    statusDiv.style.color = '#f44336';
                }
            } catch (error) {
                statusDiv.innerHTML = `âŒ Connection error: ${error.message}`;
                statusDiv.style.color = '#f44336';
            }
        }
        
        // Initialize on load
        window.onload = function() {
            // Show login screen first
            document.getElementById('loginScreen').style.display = 'flex';
        };
    </script>
</body>
</html>